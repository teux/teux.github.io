webpackJsonp([2],[,,,function(e,t,n){n(12),n(14)},,,,,,,,,function(e,t,n){(function(t){e.exports=t.blobUtil=n(13)}).call(t,function(){return this}())},function(e){var t,t;!function(t){e.exports=t()}(function(){return function e(n,o,r){function i(l,s){if(!o[l]){if(!n[l]){var c="function"==typeof t&&t;if(!s&&c)return t(l,!0);if(a)return a(l,!0);throw new Error("Cannot find module '"+l+"'")}var d=o[l]={exports:{}};n[l][0].call(d.exports,function(e){var t=n[l][1][e];return i(t?t:e)},d,d.exports,e,n,o,r)}return o[l].exports}for(var a="function"==typeof t&&t,l=0;l<r.length;l++)i(r[l]);return i}({1:[function(e,t){"use strict";function n(e){for(var t=e.length,n=new ArrayBuffer(t),o=new Uint8Array(n),r=-1;++r<t;)o[r]=e.charCodeAt(r);return n}function o(e){for(var t="",n=new Uint8Array(e),o=n.byteLength,r=-1;++r<o;)t+=String.fromCharCode(n[r]);return t}function r(e,t){return new w(function(n,o){var r=new Image;t&&(r.crossOrigin=t),r.onload=function(){n(r)},r.onerror=o,r.src=e})}function i(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");return n.drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),t}function a(e,t){return t=t||{},"string"==typeof t&&(t={type:t}),new x(e,t)}function l(e){return(window.URL||window.webkitURL).createObjectURL(e)}function s(e){return(window.URL||window.webkitURL).revokeObjectURL(e)}function c(e){return new w(function(t,n){var r=new FileReader,i="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var n=e.target.result||"";return i?t(n):void t(o(n))},r.onerror=n,i?r.readAsBinaryString(e):r.readAsArrayBuffer(e)})}function d(e,t){return w.resolve().then(function(){var o=[n(atob(e))];return t?a(o,{type:t}):a(o)})}function u(e,t){return w.resolve().then(function(){return d(btoa(e),t)})}function p(e){return c(e).then(function(e){return btoa(e)})}function f(e){return w.resolve().then(function(){var t=e.match(/data:([^;]+)/)[1],o=e.replace(/^[^,]+,/,""),r=n(atob(o));return a([r],{type:t})})}function b(e,t,n){return t=t||"image/png",r(e,n).then(function(e){return i(e)}).then(function(e){return e.toDataURL(t)})}function h(e,t){return w.resolve().then(function(){return"function"==typeof e.toBlob?new w(function(n){e.toBlob(n,t)}):f(e.toDataURL(t))})}function g(e,t,n){return t=t||"image/png",r(e,n).then(function(e){return i(e)}).then(function(e){return h(e,t)})}function v(e,t){return w.resolve().then(function(){return a([e],t)})}function m(e){return c(e).then(function(e){return n(e)})}var y=e("./utils"),x=e("blob"),w=y.Promise;t.exports={createBlob:a,createObjectURL:l,revokeObjectURL:s,imgSrcToBlob:g,imgSrcToDataURL:b,canvasToBlob:h,dataURLToBlob:f,blobToBase64String:p,base64StringToBlob:d,binaryStringToBlob:u,blobToBinaryString:c,arrayBufferToBlob:v,blobToArrayBuffer:m}},{"./utils":2,blob:3}],2:[function(e,t,n){var o="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},r="function"==typeof o.Promise?o.Promise:e("lie");n.Promise=r},{lie:8}],3:[function(e,t){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var o=n.buffer;if(n.byteLength!==o.byteLength){var r=new Uint8Array(n.byteLength);r.set(new Uint8Array(o,n.byteOffset,n.byteLength)),o=r.buffer}e[t]=o}}}function o(e,t){t=t||{};var o=new a;n(e);for(var r=0;r<e.length;r++)o.append(e[r]);return t.type?o.getBlob(t.type):o.getBlob()}function r(e,t){return n(e),new Blob(e,t||{})}var i="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},a=i.BlobBuilder||i.WebKitBlobBuilder||i.MSBlobBuilder||i.MozBlobBuilder,l=function(){try{var e=new Blob(["hi"]);return 2===e.size}catch(t){return!1}}(),s=l&&function(){try{var e=new Blob([new Uint8Array([1,2])]);return 2===e.size}catch(t){return!1}}(),c=a&&a.prototype.append&&a.prototype.getBlob;t.exports=function(){return l?s?i.Blob:r:c?o:void 0}()},{}],4:[function(){},{}],5:[function(e,t){"use strict";function n(){}t.exports=n},{}],6:[function(e,t){"use strict";function n(e){function t(e,t){function o(e){c[t]=e,++d===n&!s&&(s=!0,l.resolve(p,c))}i(e).then(o,function(e){s||(s=!0,l.reject(p,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return r(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return i([]);for(var c=new Array(n),d=0,u=-1,p=new o(a);++u<n;)t(e[u],u);return p}var o=e("./promise"),r=e("./reject"),i=e("./resolve"),a=e("./INTERNAL"),l=e("./handlers");t.exports=n},{"./INTERNAL":5,"./handlers":7,"./promise":9,"./reject":12,"./resolve":13}],7:[function(e,t,n){"use strict";function o(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var r=e("./tryCatch"),i=e("./resolveThenable"),a=e("./states");n.resolve=function(e,t){var l=r(o,t);if("error"===l.status)return n.reject(e,l.value);var s=l.value;if(s)i.safely(e,s);else{e.state=a.FULFILLED,e.outcome=t;for(var c=-1,d=e.queue.length;++c<d;)e.queue[c].callFulfilled(t)}return e},n.reject=function(e,t){e.state=a.REJECTED,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callRejected(t);return e}},{"./resolveThenable":14,"./states":15,"./tryCatch":16}],8:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all"),n.race=e("./race")},{"./all":6,"./promise":9,"./race":11,"./reject":12,"./resolve":13}],9:[function(e,t){"use strict";function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("reslover must be a function");this.state=a.PENDING,this.queue=[],this.outcome=void 0,e!==r&&i.safely(this,e)}var o=e("./unwrap"),r=e("./INTERNAL"),i=e("./resolveThenable"),a=e("./states"),l=e("./queueItem");t.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a.FULFILLED||"function"!=typeof t&&this.state===a.REJECTED)return this;var i=new n(r);if(this.state!==a.PENDING){var s=this.state===a.FULFILLED?e:t;o(i,s,this.outcome)}else this.queue.push(new l(i,e,t));return i}},{"./INTERNAL":5,"./queueItem":10,"./resolveThenable":14,"./states":15,"./unwrap":17}],10:[function(e,t){"use strict";function n(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var o=e("./handlers"),r=e("./unwrap");t.exports=n,n.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){r(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){o.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){r(this.promise,this.onRejected,e)}},{"./handlers":7,"./unwrap":17}],11:[function(e,t){"use strict";function n(e){function t(e){i(e).then(function(e){s||(s=!0,l.resolve(d,e))},function(e){s||(s=!0,l.reject(d,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return r(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return i([]);for(var c=-1,d=new o(a);++c<n;)t(e[c]);return d}var o=e("./promise"),r=e("./reject"),i=e("./resolve"),a=e("./INTERNAL"),l=e("./handlers");t.exports=n},{"./INTERNAL":5,"./handlers":7,"./promise":9,"./reject":12,"./resolve":13}],12:[function(e,t){"use strict";function n(e){var t=new o(r);return i.reject(t,e)}var o=e("./promise"),r=e("./INTERNAL"),i=e("./handlers");t.exports=n},{"./INTERNAL":5,"./handlers":7,"./promise":9}],13:[function(e,t){"use strict";function n(e){if(e)return e instanceof o?e:i.resolve(new o(r),e);var t=typeof e;switch(t){case"boolean":return a;case"undefined":return s;case"object":return l;case"number":return c;case"string":return d}}var o=e("./promise"),r=e("./INTERNAL"),i=e("./handlers");t.exports=n;var a=i.resolve(new o(r),!1),l=i.resolve(new o(r),null),s=i.resolve(new o(r),void 0),c=i.resolve(new o(r),0),d=i.resolve(new o(r),"")},{"./INTERNAL":5,"./handlers":7,"./promise":9}],14:[function(e,t,n){"use strict";function o(e,t){function n(t){l||(l=!0,r.reject(e,t))}function o(t){l||(l=!0,r.resolve(e,t))}function a(){t(o,n)}var l=!1,s=i(a);"error"===s.status&&n(s.value)}var r=e("./handlers"),i=e("./tryCatch");n.safely=o},{"./handlers":7,"./tryCatch":16}],15:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],16:[function(e,t){"use strict";function n(e,t){var n={};try{n.value=e(t),n.status="success"}catch(o){n.status="error",n.value=o}return n}t.exports=n},{}],17:[function(e,t){"use strict";function n(e,t,n){o(function(){var o;try{o=t(n)}catch(i){return r.reject(e,i)}o===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,o)})}var o=e("immediate"),r=e("./handlers");t.exports=n},{"./handlers":7,immediate:18}],18:[function(e,t){"use strict";function n(){r=!0;for(var e,t,n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function o(e){1!==l.push(e)||r||i()}for(var r,i,a=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],l=[],s=-1,c=a.length;++s<c;)if(a[s]&&a[s].test&&a[s].test()){i=a[s].install(n);break}t.exports=o},{"./messageChannel":19,"./mutation.js":20,"./nextTick":4,"./stateChange":21,"./timeout":22}],19:[function(e,t,n){var o="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};n.test=function(){return o.setImmediate?!1:"undefined"!=typeof o.MessageChannel},n.install=function(e){var t=new o.MessageChannel;return t.port1.onmessage=e,function(){t.port2.postMessage(0)}}},{}],20:[function(e,t,n){var o="undefined"!=typeof self?self:"undefined"!=typeof window?window:{},r=o.MutationObserver||o.WebKitMutationObserver;n.test=function(){return r},n.install=function(e){var t=0,n=new r(e),i=o.document.createTextNode("");return n.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}},{}],21:[function(e,t,n){var o="undefined"!=typeof self?self:"undefined"!=typeof window?window:{};n.test=function(){return"document"in o&&"onreadystatechange"in o.document.createElement("script")},n.install=function(e){return function(){var t=o.document.createElement("script");return t.onreadystatechange=function(){e(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},o.document.documentElement.appendChild(t),e}}},{}],22:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}]},{},[1])(1)})},function(e,t,n){(function(t){e.exports=t.PouchDB=n(15)}).call(t,function(){return this}())},function(module,exports,__webpack_require__){var require,require;!function(e){module.exports=e()}(function(){var define,module,exports;return function e(t,n,o){function r(a,l){if(!n[a]){if(!t[a]){var s="function"==typeof require&&require;if(!l&&s)return require(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return r(n?n:e)},c,c.exports,e,t,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(e,t){"use strict";function n(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n)===!0)return e[n];return!1}function o(e){return function(t,n){t||n[0]&&n[0].error?e(t||n[0]):e(null,n.length?n[0]:n)}}function r(e){var t={},n=[];return s.traverseRevTree(e,function(e,o,r,i){var a=o+"-"+r;return e&&(t[a]=0),void 0!==i&&n.push({from:i,to:a}),a}),n.reverse(),n.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:Math.min(t[e.from],1+t[e.to])}),t}function i(e,t,n){var o="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&o.reverse(),!o.length)return e._allDocs({limit:0},n);var r={offset:t.skip};return f.all(o.map(function(n){var o=l.extend(!0,{key:n,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete o[e]}),new f(function(t,i){e._allDocs(o,function(e,o){return e?i(e):(r.total_rows=o.total_rows,void t(o.rows[0]||{key:n,error:"not_found"}))})})})).then(function(e){return r.rows=e,r})}function a(){var e=this;d.call(this),e.autoCompact=function(t){return e.auto_compaction&&"http"!==e.type()?function(n,o){if(n)t(n);else{var r=o.length,i=function(){r--,r||t(null,o)};if(!o.length)return t(null,o);o.forEach(function(t){t.ok&&t.id?e.compactDocument(t.id,0,i):i()})}}:t};var t,n=0,o=["change","delete","create","update"];this.on("newListener",function(r){if(~o.indexOf(r)){if(n)return void n++;n++;var i=0;t=this.changes({conflicts:!0,include_docs:!0,continuous:!0,since:"now",onChange:function(t){t.seq<=i||(i=t.seq,e.emit("change",t),t.doc._deleted?e.emit("delete",t):"1"===t.doc._rev.split("-")[0]?e.emit("create",t):e.emit("update",t))}})}}),this.on("removeListener",function(e){~o.indexOf(e)&&(n--,n||t.cancel())})}var l=e("./utils"),s=e("./merge"),c=e("./deps/errors"),d=e("events").EventEmitter,u=e("./deps/upsert"),p=e("./changes"),f=l.Promise;l.inherits(a,d),t.exports=a,a.prototype.post=l.adapterFun("post",function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!=typeof e||Array.isArray(e)?n(c.NOT_AN_OBJECT):void this.bulkDocs({docs:[e]},t,this.autoCompact(o(n)))}),a.prototype.put=l.adapterFun("put",l.getArguments(function(e){var t,n,r,i,a=e.shift(),s="_id"in a;if("object"!=typeof a||Array.isArray(a))return(i=e.pop())(c.NOT_AN_OBJECT);for(a=l.clone(a);t=e.shift(),n=typeof t,"string"!==n||s?"string"!==n||!s||"_rev"in a?"object"===n?r=t:"function"===n&&(i=t):a._rev=t:(a._id=t,s=!0),e.length;);r=r||{};var d=l.invalidIdError(a._id);return d?i(d):l.isLocalId(a._id)&&"function"==typeof this._putLocal?a._deleted?this._removeLocal(a,i):this._putLocal(a,i):void this.bulkDocs({docs:[a]},r,this.autoCompact(o(i)))})),a.prototype.putAttachment=l.adapterFun("putAttachment",function(e,t,n,o,r,i){function a(e){return e._attachments=e._attachments||{},e._attachments[t]={content_type:r,data:o},l.put(e)}var l=this;return"function"==typeof r&&(i=r,r=o,o=n,n=null),"undefined"==typeof r&&(r=o,o=n,n=null),l.get(e).then(function(e){if(e._rev!==n)throw c.REV_CONFLICT;return a(e)},function(t){if(t.error===c.MISSING_DOC.error)return a({_id:e});throw t})}),a.prototype.removeAttachment=l.adapterFun("removeAttachment",function(e,t,n,o){var r=this;r.get(e,function(e,i){return e?void o(e):i._rev!==n?void o(c.REV_CONFLICT):i._attachments?(delete i._attachments[t],0===Object.keys(i._attachments).length&&delete i._attachments,void r.put(i,o)):o()})}),a.prototype.remove=l.adapterFun("remove",function(e,t,n,r){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t)),n=l.clone(n||{}),n.was_delete=!0;var a={_id:i._id,_rev:i._rev||n.rev};return a._deleted=!0,l.isLocalId(a._id)&&"function"==typeof this._removeLocal?this._removeLocal(i,r):void this.bulkDocs({docs:[a]},n,o(r))}),a.prototype.revsDiff=l.adapterFun("revsDiff",function(e,t,n){function o(e,t){c.has(e)||c.set(e,{missing:[]}),c.get(e).missing.push(t)}function r(t,n){var r=e[t].slice(0);s.traverseRevTree(n,function(e,n,i,a,l){var s=n+"-"+i,c=r.indexOf(s);-1!==c&&(r.splice(c,1),"available"!==l.status&&o(t,s))}),r.forEach(function(e){o(t,e)})}"function"==typeof t&&(n=t,t={}),t=l.clone(t);var i=Object.keys(e);if(!i.length)return n(null,{});var a=0,c=new l.Map;i.map(function(t){this._getRevisionTree(t,function(o,l){if(o&&404===o.status&&"missing"===o.message)c.set(t,{missing:e[t]});else{if(o)return n(o);r(t,l)}if(++a===i.length){var s={};return c.forEach(function(e,t){s[t]=e}),n(null,s)}})},this)}),a.prototype.compactDocument=l.adapterFun("compactDocument",function(e,t,n){var o=this;this._getRevisionTree(e,function(i,a){if(i)return n(i);var l=r(a),c=[],d=[];Object.keys(l).forEach(function(e){l[e]>t&&c.push(e)}),s.traverseRevTree(a,function(e,t,n,o,r){var i=t+"-"+n;"available"===r.status&&-1!==c.indexOf(i)&&d.push(i)}),o._doCompaction(e,d,n)})}),a.prototype.compact=l.adapterFun("compact",function(e,t){"function"==typeof e&&(t=e,e={});var n=this;e=l.clone(e||{}),n.get("_local/compaction")["catch"](function(){return!1}).then(function(o){return"function"==typeof n._compact?(o&&o.last_seq&&(e.last_seq=o.last_seq),n._compact(e,t)):void 0})}),a.prototype._compact=function(e,t){function n(){u(c,"_local/compaction",function(e){return!e.last_seq||e.last_seq<i?(e.last_seq=i,e):!1},t)}function o(){l--,!l&&a&&n()}function r(e){l++,c.compactDocument(e.id,0).then(o,t)}var i,a=!1,l=0,s={returnDocs:!1},c=this;e.last_seq&&(s.since=e.last_seq),c.changes(s).on("change",r).on("complete",function(e){a=!0,i=e.last_seq,l||n()}).on("error",t)},a.prototype.get=l.adapterFun("get",function(e,t,o){function r(){var n=[],r=i.length;return r?void i.forEach(function(i){a.get(e,{rev:i,revs:t.revs,attachments:t.attachments},function(e,t){n.push(e?{missing:i}:{ok:t}),r--,r||o(null,n)})}):o(null,n)}if("function"==typeof t&&(o=t,t={}),"string"!=typeof e)return o(c.INVALID_ID);if(l.isLocalId(e)&&"function"==typeof this._getLocal)return this._getLocal(e,o);var i=[],a=this;if(!t.open_revs)return this._get(e,t,function(e,r){if(t=l.clone(t),e)return o(e);var i=r.doc;if(!i)return o(new Error("no doc!"));var c=r.metadata,d=r.ctx;if(t.conflicts){var u=s.collectConflicts(c);u.length&&(i._conflicts=u)}if(t.revs||t.revs_info){var p=s.rootToLeaf(c.rev_tree),f=n(p,function(e){return-1!==e.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])}),b=f.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1,h=f.ids.length-b;if(f.ids.splice(b,h),f.ids.reverse(),t.revs&&(i._revisions={start:f.pos+f.ids.length-1,ids:f.ids.map(function(e){return e.id})}),t.revs_info){var g=f.pos+f.ids.length;i._revs_info=f.ids.map(function(e){return g--,{rev:g+"-"+e.id,status:e.opts.status}})}}if(t.local_seq&&(i._local_seq=r.metadata.seq),t.attachments&&i._attachments){var v=i._attachments,m=Object.keys(v).length;if(0===m)return o(null,i);Object.keys(v).forEach(function(e){this._getAttachment(v[e],{encode:!0,ctx:d},function(t,n){var r=i._attachments[e];r.data=n,delete r.stub,delete r.length,--m||o(null,i)})},a)}else{if(i._attachments)for(var y in i._attachments)i._attachments.hasOwnProperty(y)&&(i._attachments[y].stub=!0);o(null,i)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){e&&(t=[]),i=s.collectLeaves(t).map(function(e){return e.rev}),r()});else{if(!Array.isArray(t.open_revs))return o(c.error(c.UNKNOWN_ERROR,"function_clause"));i=t.open_revs;for(var d=0;d<i.length;d++){var u=i[d];if("string"!=typeof u||!/^\d+-/.test(u))return o(c.error(c.BAD_REQUEST,"Invalid rev format"))}r()}}),a.prototype.getAttachment=l.adapterFun("getAttachment",function(e,t,n,o){var r=this;n instanceof Function&&(o=n,n={}),n=l.clone(n),this._get(e,n,function(e,i){return e?o(e):i.doc._attachments&&i.doc._attachments[t]?(n.ctx=i.ctx,void r._getAttachment(i.doc._attachments[t],n,o)):o(c.MISSING_DOC)})}),a.prototype.allDocs=l.adapterFun("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e=l.clone(e),e.skip="undefined"!=typeof e.skip?e.skip:0,"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(n)return void t(c.error(c.QUERY_PARSE_ERROR,"Query parameter `"+n+"` is not compatible with multi-get"));if("http"!==this.type())return i(this,e,t)}return this._allDocs(e,t)}),a.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new p(this,e,t)},a.prototype.close=l.adapterFun("close",function(e){return this._closed=!0,this._close(e)}),a.prototype.info=l.adapterFun("info",function(e){var t=this;this._info(function(n,o){return n?e(n):(o.db_name=o.db_name||t._db_name,o.auto_compaction=!(!t._auto_compaction||"http"===t.type()),void e(null,o))})}),a.prototype.id=l.adapterFun("id",function(e){return this._id(e)}),a.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},a.prototype.bulkDocs=l.adapterFun("bulkDocs",function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=l.clone(t),Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(c.MISSING_BULK_DOCS);for(var o=0;o<e.docs.length;++o)if("object"!=typeof e.docs[o]||Array.isArray(e.docs[o]))return n(c.NOT_AN_OBJECT);return e=l.clone(e),"new_edits"in t||(t.new_edits="new_edits"in e?e.new_edits:!0),t.new_edits||"http"===this.type()||e.docs.sort(function(e,t){var n=l.compare(e._id,t._id);if(0!==n)return n;var o=e._revisions?e._revisions.start:0,r=t._revisions?t._revisions.start:0;return l.compare(o,r)}),this._bulkDocs(e,t,this.autoCompact(function(e,o){return e?n(e):(t.new_edits||(o=o.filter(function(e){return e.error})),void n(null,o))}))}),a.prototype.registerDependentDatabase=l.adapterFun("registerDependentDatabase",function(e,t){function n(t){return t.dependentDbs=t.dependentDbs||{},t.dependentDbs[e]?!1:(t.dependentDbs[e]=!0,t)}var o={};this.__opts.db&&(o.db=this.__opts.db),this._adapter&&(o.adapter=this._adapter);var r=new this.constructor(e,o);u(this,"_local/_pouch_dependentDbs",n,function(e){return e?t(e):t(null,{db:r})})})},{"./changes":6,"./deps/errors":12,"./deps/upsert":16,"./merge":21,"./utils":26,events:30}],2:[function(e,t){(function(n){"use strict";function o(e){return/^_(design|local)/.test(e)?e:encodeURIComponent(e)}function r(e){return e._attachments&&Object.keys(e._attachments)?d.Promise.all(Object.keys(e._attachments).map(function(t){var o=e._attachments[t];if(o.data&&"string"!=typeof o.data){if(void 0===typeof n||n.browser)return new d.Promise(function(e){d.readAsBinaryString(o.data,function(t){o.data=d.btoa(t),e()})});o.data=o.data.toString("base64")}})):d.Promise.resolve()}function i(e,t){if(/http(s?):/.test(e)){var n=d.parseUri(e);n.remote=!0,(n.user||n.password)&&(n.auth={username:n.user,password:n.password});var o=n.path.replace(/(^\/|\/$)/g,"").split("/");if(n.db=o.pop(),n.path=o.join("/"),t=t||{},t=d.clone(t),n.headers=t.headers||{},t.auth||n.auth){var r=t.auth||n.auth,i=d.btoa(r.username+":"+r.password);n.headers.Authorization="Basic "+i}return t.headers&&(n.headers=t.headers),n}return{host:"",path:"/",db:e,auth:!1}}function a(e,t){return l(e,e.db+"/"+t)}function l(e,t){if(e.remote){var n=e.path?"/":"";return e.protocol+"://"+e.host+":"+e.port+"/"+e.path+n+t}return"/"+t}function s(e,t){function n(e,t){return d.ajax(d.extend({},h,e),t)}function s(e){return e.split("/").map(encodeURIComponent).join("/")}var p=this;p.getHost=e.getHost?e.getHost:i;var f=p.getHost(e.name,e),b=a(f,"");p.getUrl=function(){return b},p.getHeaders=function(){return d.clone(f.headers)};var h=e.ajax||{};e=d.clone(e);var g=function(){n({headers:f.headers,method:"PUT",url:b},function(e){e&&401===e.status?n({headers:f.headers,method:"HEAD",url:b},function(e){e?t(e):t(null,p)}):e&&412!==e.status?t(e):t(null,p)})};e.skipSetup||n({headers:f.headers,method:"GET",url:b},function(e){e?404===e.status?(d.explain404("PouchDB is just detecting if the remote DB exists."),g()):t(e):t(null,p)}),p.type=function(){return"http"},p.id=d.adapterFun("id",function(e){n({headers:f.headers,method:"GET",url:l(f,"")},function(t,n){var o=n&&n.uuid?n.uuid+f.db:a(f,"");e(null,o)})}),p.request=d.adapterFun("request",function(e,t){e.headers=f.headers,e.url=a(f,e.url),n(e,t)}),p.compact=d.adapterFun("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=d.clone(e),n({headers:f.headers,url:a(f,"_compact"),method:"POST"},function(){function n(){p.info(function(o,r){r.compact_running?setTimeout(n,e.interval||200):t()})}"function"==typeof t&&n()})}),p._info=function(e){n({headers:f.headers,method:"GET",url:a(f,"")},function(t,n){t?e(t):(n.host=a(f,""),e(null,n))})},p.get=d.adapterFun("get",function(e,t,r){"function"==typeof t&&(r=t,t={}),t=d.clone(t),void 0===t.auto_encode&&(t.auto_encode=!0);var i=[];t.revs&&i.push("revs=true"),t.revs_info&&i.push("revs_info=true"),t.local_seq&&i.push("local_seq=true"),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),i.push("open_revs="+t.open_revs)),t.attachments&&i.push("attachments=true"),t.rev&&i.push("rev="+t.rev),t.conflicts&&i.push("conflicts="+t.conflicts),i=i.join("&"),i=""===i?"":"?"+i,t.auto_encode&&(e=o(e));var l={headers:f.headers,method:"GET",url:a(f,e+i)},s=e.split("/");(s.length>1&&"_design"!==s[0]&&"_local"!==s[0]||s.length>2&&"_design"===s[0]&&"_local"!==s[0])&&(l.binary=!0),n(l,function(e,t,n){return e?r(e):void r(null,t,n)})}),p.remove=d.adapterFun("remove",function(e,t,r,i){var l;"string"==typeof t?(l={_id:e,_rev:t},"function"==typeof r&&(i=r,r={})):(l=e,"function"==typeof t?(i=t,r={}):(i=r,r=t));var s=l._rev||r.rev;n({headers:f.headers,method:"DELETE",url:a(f,o(l._id))+"?rev="+s},i)}),p.getAttachment=d.adapterFun("getAttachment",function(e,t,n,r){"function"==typeof n&&(r=n,n={}),n=d.clone(n),void 0===n.auto_encode&&(n.auto_encode=!0),n.auto_encode&&(e=o(e)),n.auto_encode=!1,p.get(e+"/"+s(t),n,r)}),p.removeAttachment=d.adapterFun("removeAttachment",function(e,t,r,i){var l=a(f,o(e)+"/"+s(t))+"?rev="+r;n({headers:f.headers,method:"DELETE",url:l},i)}),p.putAttachment=d.adapterFun("putAttachment",function(e,t,r,i,l,c){"function"==typeof l&&(c=l,l=i,i=r,r=null),"undefined"==typeof l&&(l=i,i=r,r=null);var p=o(e)+"/"+s(t),b=a(f,p);if(r&&(b+="?rev="+r),"string"==typeof i)try{i=d.atob(i)}catch(h){return c(d.extend({},u.BAD_ARG,{reason:"Attachments need to be base64 encoded"}))}var g={headers:d.clone(f.headers),method:"PUT",url:b,processData:!1,body:i,timeout:6e4};g.headers["Content-Type"]=l,n(g,c)}),p.put=d.adapterFun("put",d.getArguments(function(e){var t,i,l,s=e.shift(),c="_id"in s,p=e.pop();return"object"!=typeof s||Array.isArray(s)?p(u.NOT_AN_OBJECT):(s=d.clone(s),void r(s).then(function(){for(;t=e.shift(),i=typeof t,"string"!==i||c?"string"!==i||!c||"_rev"in s?"object"===i&&(l=d.clone(t)):s._rev=t:(s._id=t,c=!0),e.length;);l=l||{};var r=d.invalidIdError(s._id);if(r)throw r;var u=[];l&&"undefined"!=typeof l.new_edits&&u.push("new_edits="+l.new_edits),u=u.join("&"),""!==u&&(u="?"+u),n({headers:f.headers,method:"PUT",url:a(f,o(s._id))+u,body:s},function(e,t){return e?p(e):(t.ok=!0,void p(null,t))})})["catch"](p))})),p.post=d.adapterFun("post",function(e,t,n){return"function"==typeof t&&(n=t,t={}),t=d.clone(t),"object"!=typeof e?n(u.NOT_AN_OBJECT):("_id"in e||(e._id=d.uuid()),void p.put(e,t,function(e,t){return e?n(e):(t.ok=!0,void n(null,t))}))}),p._bulkDocs=function(e,t,o){"undefined"!=typeof t.new_edits&&(e.new_edits=t.new_edits),d.Promise.all(e.docs.map(r)).then(function(){n({headers:f.headers,method:"POST",url:a(f,"_bulk_docs"),body:e},function(e,t){return e?o(e):(t.forEach(function(e){e.ok=!0}),void o(null,t))})})["catch"](o)},p.allDocs=d.adapterFun("allDocs",function(e,t){"function"==typeof e&&(t=e,e={}),e=d.clone(e);var o,r=[],i="GET";if(e.conflicts&&r.push("conflicts=true"),e.descending&&r.push("descending=true"),e.include_docs&&r.push("include_docs=true"),e.key&&r.push("key="+encodeURIComponent(JSON.stringify(e.key))),e.startkey&&r.push("startkey="+encodeURIComponent(JSON.stringify(e.startkey))),e.endkey&&r.push("endkey="+encodeURIComponent(JSON.stringify(e.endkey))),"undefined"!=typeof e.inclusive_end&&r.push("inclusive_end="+!!e.inclusive_end),"undefined"!=typeof e.limit&&r.push("limit="+e.limit),"undefined"!=typeof e.skip&&r.push("skip="+e.skip),r=r.join("&"),""!==r&&(r="?"+r),"undefined"!=typeof e.keys){var l=2e3,s="keys="+encodeURIComponent(JSON.stringify(e.keys));s.length+r.length+1<=l?r+=(-1!==r.indexOf("?")?"&":"?")+s:(i="POST",o=JSON.stringify({keys:e.keys}))}n({headers:f.headers,method:i,url:a(f,"_all_docs"+r),body:o},t)}),p._changes=function(e){var t="batch_size"in e?e.batch_size:c;e=d.clone(e),e.timeout=e.timeout||3e4;var o={timeout:e.timeout-5e3},r="undefined"!=typeof e.limit?e.limit:!1;0===r&&(r=1);var i;i="returnDocs"in e?e.returnDocs:!0;var l=r;if(e.style&&(o.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(o.include_docs=!0),e.continuous&&(o.feed="longpoll"),e.conflicts&&(o.conflicts=!0),e.descending&&(o.descending=!0),e.filter&&"string"==typeof e.filter&&(o.filter=e.filter,"_view"===e.filter&&e.view&&"string"==typeof e.view&&(o.view=e.view)),e.query_params&&"object"==typeof e.query_params)for(var s in e.query_params)e.query_params.hasOwnProperty(s)&&(o[s]=e.query_params[s]);if(e.continuous&&p._useSSE)return p.sse(e,o,i);var b,h,g=function(i,s){if(!e.aborted){o.since=i,e.descending?r&&(o.limit=l):o.limit=!r||l>t?t:l;var c="?"+Object.keys(o).map(function(e){return e+"="+o[e]}).join("&"),d={headers:f.headers,method:"GET",url:a(f,"_changes"+c),timeout:e.timeout};h=i,e.aborted||(b=n(d,s))}},v=10,m=0,y={results:[]},x=function(n,o){if(!e.aborted){var a=0;if(o&&o.results){a=o.results.length,y.last_seq=o.last_seq;var s={};s.query=e.query_params,o.results=o.results.filter(function(t){l--;var n=d.filterChange(e)(t);return n&&(i&&y.results.push(t),d.call(e.onChange,t)),n})}else if(n)return e.aborted=!0,void d.call(e.complete,n);o&&o.last_seq&&(h=o.last_seq);var c=r&&0>=l||o&&t>a||e.descending;if((!e.continuous||r&&0>=l)&&c)d.call(e.complete,null,y);else{n?m+=1:m=0;var p=1<<m,f=v*p,b=e.maximumWait||3e4;if(f>b)return void d.call(e.complete,n||u.UNKNOWN_ERROR);setTimeout(function(){g(h,x)},f)}}};return g(e.since||0,x),{cancel:function(){e.aborted=!0,b&&b.abort()}}},p.sse=function(e,t,n){function o(t){var o=JSON.parse(t.data);n&&c.results.push(o),c.last_seq=o.seq,d.call(e.onChange,o)}function r(t){return s.removeEventListener("message",o,!1),b===!1?(p._useSSE=!1,void(u=p._changes(e))):(s.close(),void d.call(e.complete,t))}t.feed="eventsource",t.since=e.since||0,t.limit=e.limit,delete t.timeout;var i="?"+Object.keys(t).map(function(e){return e+"="+t[e]}).join("&"),l=a(f,"_changes"+i),s=new EventSource(l),c={results:[],last_seq:!1},u=!1,b=!1;return s.addEventListener("message",o,!1),s.onopen=function(){b=!0},s.onerror=r,{cancel:function(){return u?u.cancel():(s.removeEventListener("message",o,!1),void s.close())}}},p._useSSE=!1,p.revsDiff=d.adapterFun("revsDiff",function(e,t,o){"function"==typeof t&&(o=t,t={}),n({headers:f.headers,method:"POST",url:a(f,"_revs_diff"),body:JSON.stringify(e)},o)}),p._close=function(e){e()},p.destroy=d.adapterFun("destroy",function(e){n({url:a(f,""),method:"DELETE",headers:f.headers},function(t,n){t?(p.emit("error",t),e(t)):(p.emit("destroyed"),e(null,n))})})}var c=25,d=e("../utils"),u=e("../deps/errors");s.destroy=d.toPromise(function(e,t,n){var o=i(e,t);t=t||{},"function"==typeof t&&(n=t,t={}),t=d.clone(t),t.headers=o.headers,t.method="DELETE",t.url=a(o,"");var r=t.ajax||{};t=d.extend({},t,r),d.ajax(t,n)}),s.valid=function(){return!0},t.exports=s}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"../deps/errors":12,"../utils":26,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31}],3:[function(e,t){(function(n,o){"use strict";function r(e,t,n){try{e.apply(t,n)}catch(o){window.PouchDB&&window.PouchDB.emit("error",o)}}function i(){if(!v.running&&v.queue.length){v.running=!0;var e=v.queue.shift();e.action(function(t,o){r(e.callback,this,[t,o]),v.running=!1,n.nextTick(i)})}}function a(e){return function(t){var n=t.target&&t.target.error&&t.target.error.name||t.target;e(b.error(b.IDB_ERROR,n,t.type))}}function l(e,t,n){var o={data:h.stringify(e)};return o.winningRev=t,o.deletedOrLocal=n?"1":"0",o.id=e.id,o}function s(e){if(!e)return null;if(!e.data)return e;var t=h.parse(e.data);return t.winningRev=e.winningRev,t.deletedOrLocal="1"===e.deletedOrLocal,t}function c(e,t){var n=this;v.queue.push({action:function(t){d(n,e,t)},callback:t}),i()}function d(e,t,r){function i(e){var t=e.createObjectStore(_,{keyPath:"id"});t.createIndex("seq","seq",{unique:!0}),e.createObjectStore(k,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(E,{keyPath:"digest"}),e.createObjectStore(q,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(O),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(A,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0});var n=e.createObjectStore(S,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})
}function d(e,t){var n=e.objectStore(_);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var o=e.target.result;if(o){var r=o.value,i=p.isDeleted(r);r.deletedOrLocal=i?"1":"0",n.put(r),o["continue"]()}else t()}}function u(e){e.createObjectStore(A,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function h(e,t){var n=e.objectStore(A),r=e.objectStore(_),i=e.objectStore(k),a=r.openCursor();a.onsuccess=function(e){var a=e.target.result;if(a){var l=a.value,s=l.id,c=p.isLocalId(s),d=f.winningRev(l);if(c){var u=s+"::"+d,b=s+"::",h=s+"::~",g=i.index("_doc_id_rev"),v=o.IDBKeyRange.bound(b,h,!1,!1),m=g.openCursor(v);m.onsuccess=function(e){if(m=e.target.result){var t=m.value;t._doc_id_rev===u&&n.put(t),i["delete"](m.primaryKey),m["continue"]()}else r["delete"](a.primaryKey),a["continue"]()}}else a["continue"]()}else t&&t()}}function v(e){var t=e.createObjectStore(S,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function m(e){var t=e.objectStore(k),n=e.objectStore(E),o=e.objectStore(S),r=n.count();r.onsuccess=function(e){var n=e.target.result;n&&(t.openCursor().onsuccess=function(e){var t=e.target.result;if(t){for(var n=t.value,r=t.primaryKey,i=Object.keys(n._attachments||{}),a={},l=0;l<i.length;l++){var s=n._attachments[i[l]];a[s.digest]=!0}var c=Object.keys(a);for(l=0;l<c.length;l++){var d=c[l];o.put({seq:r,digestSeq:d+"::"+r})}t["continue"]()}})}}function y(e,t,n){var r="startkey"in t?t.startkey:!1,i="endkey"in t?t.endkey:!1,a="key"in t?t.key:!1,l=t.skip||0,c="number"==typeof t.limit?t.limit:-1,d=t.inclusive_end!==!1,u="descending"in t&&t.descending?"prev":null,h=!1;u&&r&&i&&(h=i,i=!1);var g=null;try{r&&i?g=o.IDBKeyRange.bound(r,i,!1,!d):r?g=u?o.IDBKeyRange.upperBound(r):o.IDBKeyRange.lowerBound(r):i?g=u?o.IDBKeyRange.lowerBound(i,!d):o.IDBKeyRange.upperBound(i,!d):a&&(g=o.IDBKeyRange.only(a))}catch(v){return"DataError"===v.name&&0===v.code?n(null,{total_rows:e,offset:t.skip,rows:[]}):n(b.error(b.IDB_ERROR,v.name,v.message))}var m=R.transaction([_,k],"readonly");m.oncomplete=function(){n(null,{total_rows:e,offset:t.skip,rows:w})};var y=m.objectStore(_),x=u?y.openCursor(g,u):y.openCursor(g),w=[];x.onsuccess=function(e){function n(e,n){var r={id:e.id,key:e.id,value:{rev:i}};if(t.include_docs){r.doc=n,r.doc._rev=i,r.doc._doc_id_rev&&delete r.doc._doc_id_rev,t.conflicts&&(r.doc._conflicts=f.collectConflicts(e));for(var a in r.doc._attachments)r.doc._attachments.hasOwnProperty(a)&&(r.doc._attachments[a].stub=!0)}var s=p.isDeleted(e,i);if("ok"===t.deleted)s&&(r.value.deleted=!0,r.doc=null),w.push(r);else if(!s&&l--<=0){if(h){if(d&&r.key<h)return;if(!d&&r.key<=h)return}if(w.push(r),0===--c)return}o["continue"]()}if(e.target.result){var o=e.target.result,r=s(o.value),i=r.winningRev||f.winningRev(r);if(t.include_docs){var a=m.objectStore(k).index("_doc_id_rev"),u=r.id+"::"+i;a.get(u).onsuccess=function(e){n(s(o.value),e.target.result)}}else n(r)}}}function x(e){if(-1!==I)return e(null,I);var t,n=R.transaction([_],"readonly"),r=n.objectStore(_).index("deletedOrLocal");r.count(o.IDBKeyRange.only("0")).onsuccess=function(e){t=e.target.result},n.onerror=a(e),n.oncomplete=function(){I=t,e(null,I)}}var w=4,_="document-store",k="by-sequence",E="attach-store",S="attach-seq-store",q="meta-store",A="local-store",O="detect-blob-support",T=t.name,L=null,j=null,C=!1,R=null,I=-1;e.type=function(){return"idb"},e._id=p.toPromise(function(e){e(null,j)}),e._bulkDocs=function(t,n,o){function r(){if(D.length){var t=new p.Map;D.forEach(function(n,o){if(n._id&&p.isLocalId(n._id))return void e[n._deleted?"_removeLocal":"_putLocal"](n,{ctx:U},function(e){F[o]=e?e:{}});var r=n.metadata.id;t.has(r)?t.get(r).push([n,o]):t.set(r,[[n,o]])}),t.forEach(function(e,t){function n(){++r<e.length&&o()}function o(){var o=e[r],i=o[0],a=o[1];B.has(t)?y(B.get(t),i,a,n):x(i,a,n)}var r=0;o()})}}function i(e){function t(){++n===D.length&&e()}if(!D.length)return e();var n=0;D.forEach(function(e){if(e._id&&p.isLocalId(e._id))return t();var n=e.metadata.id,o=U.objectStore(_).get(n);o.onsuccess=function(e){var o=s(e.target.result);o&&B.set(n,o),t()}})}function d(){if(!z){var e=F.map(function(e){if(e._bulk_seq)delete e._bulk_seq;else if(!Object.keys(e).length)return{ok:!0};if(e.error)return e;var t=e.metadata,n=f.winningRev(t);return{ok:!0,id:t.id,rev:n}});c.Changes.notify(T),I=-1,o(null,e)}}function u(e,t){if(e.stub)return t();if("string"==typeof e.data){var n;try{n=atob(e.data)}catch(r){var i=b.error(b.BAD_ARG,"Attachments need to be base64 encoded");return o(i)}var a;if(L){var l=e.content_type;n=p.fixBinary(n),a=n.byteLength,e.data=p.createBlob([n],{type:l})}else a=n.length;return void p.MD5(n).then(function(n){e.digest="md5-"+n,e.length=a,t()})}p.readAsBinaryString(e.data,function(n){L||(e.data=btoa(n)),p.MD5(n).then(function(o){e.digest="md5-"+o,e.length=n.length,t()})})}function h(e,t){var n=U.objectStore([E]).get(e);n.onsuccess=function(n){if(n.target.result)t();else{var o=new Error("unknown stub attachment with digest "+e);o.status=412,t(o)}}}function g(e){function t(){++r===n.length&&e(o)}var n=[];if(D.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var o=e.data._attachments[t];o.stub&&n.push(o.digest)})}),!n.length)return e();var o,r=0;n.forEach(function(e){h(e,function(e){e&&!o&&(o=e),t()})})}function v(e){function t(){n++,D.length===n&&e()}if(!D.length)return e();var n=0;D.forEach(function(e){function n(){r++,r===o.length&&t()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[];if(!o.length)return t();var r=0;for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&u(e.data._attachments[i],n)})}function m(e,t,n,o,r){function i(e){d||(e?(d=e,o(d)):u===g.length&&c())}function a(e){u++,i(e)}function s(t,n){function o(){++i===a.length&&n()}function r(n){var r=e.data._attachments[n].digest,i=U.objectStore(S).put({seq:t,digestSeq:r+"::"+t});i.onsuccess=o,i.onerror=function(e){e.preventDefault(),e.stopPropagation(),o()}}var i=0,a=Object.keys(e.data._attachments||{});if(!a.length)return n();for(var l=0;l<a.length;l++)r(a[l])}function c(){function i(i){var a=e.metadata,c=i.target.result;a.seq=c,delete a.rev;var d=l(a,t,n),u=U.objectStore(_).put(d);u.onsuccess=function(){delete a.deletedOrLocal,delete a.winningRev,F[r]=e,B.set(e.metadata.id,e.metadata),s(c,function(){p.call(o)})}}e.data._doc_id_rev=h;var a=U.objectStore(k),c=a.index("_doc_id_rev"),d=a.put(e.data);d.onsuccess=i,d.onerror=function(t){t.preventDefault(),t.stopPropagation();var n=c.getKey(e.data._doc_id_rev);n.onsuccess=function(t){var n=a.put(e.data,t.target.result);n.onsuccess=i}}}var d=null,u=0,f=e.data._id=e.metadata.id,b=e.data._rev=e.metadata.rev,h=f+"::"+b;n&&(e.data._deleted=!0);var g=e.data._attachments?Object.keys(e.data._attachments):[];for(var v in e.data._attachments)if(e.data._attachments[v].stub)u++,i();else{var m=e.data._attachments[v].data;delete e.data._attachments[v].data;var y=e.data._attachments[v].digest;O(y,m,a)}g.length||c()}function y(e,t,n,o){if(p.revExists(e,t.metadata.rev))return F[n]=t,void o();var r=f.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),i=p.isDeleted(e),a=p.isDeleted(t.metadata),l=i&&a&&j||!i&&j&&"new_leaf"!==r.conflicts||i&&!a&&"new_branch"===r.conflicts;if(l)return F[n]=w(b.REV_CONFLICT,t._bulk_seq),o();t.metadata.rev_tree=r.tree;var s=f.winningRev(t.metadata);a=p.isDeleted(t.metadata,s),m(t,s,a,o,n)}function x(e,t,o){var r=f.winningRev(e.metadata),i=p.isDeleted(e.metadata,r);return"was_delete"in n&&i?(F[t]=b.MISSING_DOC,o()):void m(e,r,i,o,t)}function w(e,t){return e._bulk_seq=t,e}function O(e,t,n){var o=U.objectStore(E);o.get(e).onsuccess=function(r){var i=r.target.result;if(i)return p.call(n);var a={digest:e,body:t};o.put(a).onsuccess=function(){p.call(n)}}}var j=n.new_edits,C=t.docs,D=C.map(function(e,t){if(e._id&&p.isLocalId(e._id))return e;var n=p.parseDoc(e,j);return n._bulk_seq=t,n}),N=D.filter(function(e){return e.error});if(N.length)return o(N[0]);var U,F=new Array(D.length),B=new p.Map,z=!1;v(function(){var e=[_,k,E,q,A,S];U=R.transaction(e,"readwrite"),U.onerror=a(o),U.ontimeout=a(o),U.oncomplete=d,g(function(e){return e?(z=!0,o(e)):void i(r)})})},e._get=function(e,t,n){function o(){n(a,{doc:r,metadata:i,ctx:l})}var r,i,a,l;t=p.clone(t),l=t.ctx?t.ctx:R.transaction([_,k,E],"readonly"),l.objectStore(_).get(e).onsuccess=function(e){if(i=s(e.target.result),!i)return a=b.MISSING_DOC,o();if(p.isDeleted(i)&&!t.rev)return a=b.error(b.MISSING_DOC,"deleted"),o();var n=l.objectStore(k),c=t.rev||i.winningRev||f.winningRev(i),d=i.id+"::"+c;n.index("_doc_id_rev").get(d).onsuccess=function(e){return r=e.target.result,r&&r._doc_id_rev&&delete r._doc_id_rev,r?void o():(a=b.MISSING_DOC,o())}}},e._getAttachment=function(e,t,n){var o;t=p.clone(t),o=t.ctx?t.ctx:R.transaction([_,k,E],"readonly");var r=e.digest,i=e.content_type;o.objectStore(E).get(r).onsuccess=function(e){var o=e.target.result.body;t.encode?o?"string"!=typeof o?p.readAsBinaryString(o,function(e){n(null,btoa(e))}):n(null,o):n(null,""):o?"string"!=typeof o?n(null,o):(o=p.fixBinary(atob(o)),n(null,p.createBlob([o],{type:i}))):n(null,p.createBlob([""],{type:i}))}},e._allDocs=function(e,t){x(function(n,o){return n?t(n):0===e.limit?t(null,{total_rows:o,offset:e.skip,rows:[]}):void y(o,e,t)})},e._info=function(e){x(function(t,n){if(t)return e(t);if(null===R){var o=new Error("db isn't open");return o.id="idbNull",e(o)}var r=0,i=R.transaction([k],"readonly");i.objectStore(k).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;r=t?t.key:0},i.oncomplete=function(){e(null,{doc_count:n,update_seq:r})}})},e._changes=function(t){function n(){h=R.transaction([_,k],"readonly"),h.oncomplete=i;var e;e=l?h.objectStore(k).openCursor(o.IDBKeyRange.lowerBound(t.since,!0),l):h.objectStore(k).openCursor(o.IDBKeyRange.lowerBound(t.since,!0)),e.onsuccess=r,e.onerror=onerror}function r(e){var n=e.target.result;if(n){var o=n.value;if(t.doc_ids&&-1===t.doc_ids.indexOf(o._id))return n["continue"]();var r=h.objectStore(_);r.get(o._id).onsuccess=function(e){var r=s(e.target.result);d<r.seq&&(d=r.seq);var i=r.winningRev||f.winningRev(r);if(o._rev!==i)return n["continue"]();delete o._doc_id_rev;var a=t.processChange(o,r,t);a.seq=n.key,m(a)&&(v++,b&&g.push(a),t.onChange(a)),v!==u&&n["continue"]()}}}function i(){t.continuous||t.complete(null,{results:g,last_seq:d})}if(t=p.clone(t),t.continuous){var a=T+":"+p.uuid();return c.Changes.addListener(T,a,e,t),c.Changes.notify(T),{cancel:function(){c.Changes.removeListener(T,a)}}}var l=t.descending?"prev":null,d=0;t.since=t.since&&!l?t.since:0;var u="limit"in t?t.limit:-1;0===u&&(u=1);var b;b="returnDocs"in t?t.returnDocs:!0;var h,g=[],v=0,m=p.filterChange(t);n()},e._close=function(e){return null===R?e(b.NOT_OPEN):(R.close(),delete g[T],R=null,void e())},e._getRevisionTree=function(e,t){var n=R.transaction([_],"readonly"),o=n.objectStore(_).get(e);o.onsuccess=function(e){var n=s(e.target.result);n?t(null,n.rev_tree):t(b.MISSING_DOC)}},e._doCompaction=function(e,t,n){function r(){h.length&&h.forEach(function(e){var t=b.index("digestSeq").count(o.IDBKeyRange.bound(e+"::",e+"::ï¿¿",!1,!1));t.onsuccess=function(t){var n=t.target.result;n||u["delete"](e)}})}var i=R.transaction([_,k,E,S],"readwrite"),c=i.objectStore(_),d=i.objectStore(k),u=i.objectStore(E),b=i.objectStore(S),h=[];c.get(e).onsuccess=function(n){var a=s(n.target.result);f.traverseRevTree(a.rev_tree,function(e,n,o,r,i){var a=n+"-"+o;-1!==t.indexOf(a)&&(i.status="missing")});var c=t.length;t.forEach(function(t){var n=d.index("_doc_id_rev"),s=e+"::"+t;n.getKey(s).onsuccess=function(e){var t=e.target.result;if("number"==typeof t){d["delete"](t);var n=b.index("seq").openCursor(o.IDBKeyRange.only(t));n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];h.push(n),b["delete"](t.primaryKey),t["continue"]()}else if(c--,!c){var o=a.winningRev||f.winningRev(a),s=a.deletedOrLocal;i.objectStore(_).put(l(a,o,s)),r()}}}}})},i.onerror=a(n),i.oncomplete=function(){p.call(n)}},e._getLocal=function(e,t){var n=R.transaction([A],"readonly"),o=n.objectStore(A).get(e);o.onerror=a(t),o.onsuccess=function(e){var n=e.target.result;n?(delete n._doc_id_rev,t(null,n)):t(b.MISSING_DOC)}},e._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),delete e._revisions;var o=e._rev,r=e._id;e._rev=o?"0-"+(parseInt(o.split("-")[1],10)+1):"0-1",e._doc_id_rev=r+"::"+e._rev;var i,l=t.ctx;l||(l=R.transaction([A],"readwrite"),l.onerror=a(n),l.oncomplete=function(){i&&n(null,i)});var s,c=l.objectStore(A);if(o){var d=c.index("_doc_id_rev"),u=r+"::"+o;s=d.get(u),s.onsuccess=function(o){if(o.target.result){var r=c.put(e);r.onsuccess=function(){i={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,i)}}else n(b.REV_CONFLICT)}}else s=c.get(r),s.onsuccess=function(o){if(o.target.result)n(b.REV_CONFLICT);else{var r=c.put(e);r.onsuccess=function(){i={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,i)}}}},e._removeLocal=function(e,t){var n,o=R.transaction([A],"readwrite");o.oncomplete=function(){n&&t(null,n)};var r=e._id+"::"+e._rev,i=o.objectStore(A),l=i.index("_doc_id_rev"),s=l.get(r);s.onerror=a(t),s.onsuccess=function(e){var o=e.target.result;if(o){var a=l.getKey(r);a.onsuccess=function(e){var t=e.target.result;i["delete"](t),n={ok:!0,id:o._id,rev:"0-0"}}}else t(b.MISSING_DOC)}};var D=g[T];if(D)return R=D.idb,L=D.blobSupport,j=D.instanceId,C=D.idStored,void n.nextTick(function(){r(null,e)});var N=o.indexedDB.open(T,w);"openReqList"in c||(c.openReqList={}),c.openReqList[T]=N,N.onupgradeneeded=function(e){var t=e.target.result;if(e.oldVersion<1)return void i(t);var n=e.currentTarget.transaction;e.oldVersion<4&&(v(t),e.oldVersion<3?(u(t),e.oldVersion<2?d(n,function(){h(n,function(){m(n)})}):h(n,function(){m(n)})):m(n))},N.onsuccess=function(t){R=t.target.result,R.onversionchange=function(){R.close(),delete g[T]},R.onabort=function(){R.close(),delete g[T]};var n=R.transaction([q,O],"readwrite"),o=n.objectStore(q).get(q);o.onsuccess=function(t){var o=function(){null!==L&&C&&(g[T]={idb:R,blobSupport:L,instanceId:j,idStored:C,loaded:!0},r(null,e))},i=t.target.result||{id:q};T+"_id"in i?(j=i[T+"_id"],C=!0,o()):(j=p.uuid(),i[T+"_id"]=j,n.objectStore(q).put(i).onsuccess=function(){C=!0,o()});try{var a=p.createBlob([""],{type:"image/png"});n.objectStore(O).put(a,"key"),n.oncomplete=function(){n=R.transaction([q,O],"readwrite");var e=n.objectStore(O).get("key");e.onsuccess=function(e){var t=e.target.result,n=URL.createObjectURL(t);p.ajax({url:n,cache:!0,binary:!0},function(e,t){e&&405===e.status?L=!0:(L=!(!t||"image/png"!==t.type),e&&404===e.status&&p.explain404("PouchDB is just detecting blob URL support.")),URL.revokeObjectURL(n),o()})}}}catch(l){L=!1,o()}}},N.onerror=a(r)}function u(e,t,n){"openReqList"in c||(c.openReqList={}),c.Changes.removeAllListeners(e),c.openReqList[e]&&c.openReqList[e].result&&c.openReqList[e].result.close();var r=o.indexedDB.deleteDatabase(e);r.onsuccess=function(){c.openReqList[e]&&(c.openReqList[e]=null),p.hasLocalStorage()&&e in o.localStorage&&delete o.localStorage[e],delete g[e],n(null,{ok:!0})},r.onerror=a(n)}var p=e("../utils"),f=e("../merge"),b=e("../deps/errors"),h=e("vuvuzela"),g={},v={running:!1,queue:[]};c.valid=function(){var e="undefined"!=typeof openDatabase&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent);return!e&&o.indexedDB&&o.IDBKeyRange},c.destroy=p.toPromise(function(e,t,n){v.queue.push({action:function(n){u(e,t,n)},callback:n}),i()}),c.Changes=new p.Changes,t.exports=c}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":12,"../merge":21,"../utils":26,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31,vuvuzela:61}],4:[function(e,t){t.exports=["idb","websql"]},{}],5:[function(e,t){(function(n){"use strict";function o(e){return"'"+e+"'"}function r(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function i(e){return e.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function a(e,t,n,o,r){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(n?" ON "+n:"")+(o?" WHERE "+("string"==typeof o?o:o.join(" AND ")):"")+(r?" ORDER BY "+r:"")}function l(e){return function(t){var n=t&&t.constructor.toString().match(/function ([^\(]+)/),o=n&&n[1]||t.type,r=t.target||t.message;e(b.error(b.WSQ_ERROR,r,o))}}function s(e){return delete e._id,delete e._rev,JSON.stringify(e)}function c(e,t,n){return e=JSON.parse(e),e._id=t,e._rev=n,e}function d(e){if("size"in e)return 1e6*e.size;var t=/Android/.test(window.navigator.userAgent);return t?5e6:1}function u(e,t){function o(){p.hasLocalStorage()&&(n.localStorage["_pouch__websqldb_"+X]=!0),t(null,J)}function v(e,t){e.executeSql(T),e.executeSql("ALTER TABLE "+_+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(A),e.executeSql("ALTER TABLE "+w+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+w+" (local, id)");var n="SELECT "+w+".winningseq AS seq, "+w+".json AS metadata FROM "+_+" JOIN "+w+" ON "+_+".seq = "+w+".winningseq";e.executeSql(n,[],function(e,n){for(var o=[],r=[],i=0;i<n.rows.length;i++){var a=n.rows.item(i),l=a.seq,s=JSON.parse(a.metadata);p.isDeleted(s)&&o.push(l),p.isLocalId(s.id)&&r.push(s.id)}e.executeSql("UPDATE "+w+"SET local = 1 WHERE id IN ("+r.map(function(){return"?"}).join(",")+")",r,function(){e.executeSql("UPDATE "+_+" SET deleted = 1 WHERE seq IN ("+o.map(function(){return"?"}).join(",")+")",o,t)})})})})}function I(e,t){var n="CREATE TABLE IF NOT EXISTS "+E+" (id UNIQUE, rev, json)";e.executeSql(n,[],function(){var n="SELECT "+w+".id AS id, "+_+".json AS data FROM "+_+" JOIN "+w+" ON "+_+".seq = "+w+".winningseq WHERE local = 1";e.executeSql(n,[],function(e,n){function o(){if(!r.length)return t(e);var n=r.shift(),i=JSON.parse(n.data)._rev;e.executeSql("INSERT INTO "+E+" (id, rev, json) VALUES (?,?,?)",[n.id,i,n.data],function(e){e.executeSql("DELETE FROM "+w+" WHERE id=?",[n.id],function(e){e.executeSql("DELETE FROM "+_+" WHERE seq=?",[n.seq],function(){o()})})})}for(var r=[],i=0;i<n.rows.length;i++)r.push(n.rows.item(i));o()})})}function D(e,t){function n(n){function o(){if(!n.length)return t(e);var r=n.shift(),i=g(r.hex,V),a=i.lastIndexOf("::"),l=i.substring(0,a),s=i.substring(a+2),c="UPDATE "+_+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(c,[l,s,i],function(){o()})}o()}var o="ALTER TABLE "+_+" ADD COLUMN doc_id";e.executeSql(o,[],function(e){var t="ALTER TABLE "+_+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(O,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+_;e.executeSql(t,[],function(e,t){for(var o=[],r=0;r<t.rows.length;r++)o.push(t.rows.item(r));n(o)})})})})}function N(e,t){function n(e){var n="SELECT COUNT(*) AS cnt FROM "+k;e.executeSql(n,[],function(e,n){function o(){var n=a(R+", "+w+".id AS id",[w,_],C,null,w+".id ");n+=" LIMIT "+l+" OFFSET "+i,i+=l,e.executeSql(n,[],function(e,n){function r(e,t){var n=i[e]=i[e]||[];-1===n.indexOf(t)&&n.push(t)}if(!n.rows.length)return t(e);for(var i={},a=0;a<n.rows.length;a++)for(var l=n.rows.item(a),s=c(l.data,l.id,l.rev),d=Object.keys(s._attachments||{}),u=0;u<d.length;u++){var p=s._attachments[d[u]];r(p.digest,l.seq)}var f=[];if(Object.keys(i).forEach(function(e){var t=i[e];t.forEach(function(t){f.push([e,t])})}),!f.length)return o();var b=0;f.forEach(function(t){var n="INSERT INTO "+q+" (digest, seq) VALUES (?,?)";e.executeSql(n,t,function(){++b===f.length&&o()})})})}var r=n.rows.item(0).cnt;if(!r)return t(e);var i=0,l=10;o()})}var o="CREATE TABLE IF NOT EXISTS "+q+" (digest, seq INTEGER)";e.executeSql(o,[],function(e){e.executeSql(j,[],function(e){e.executeSql(L,[],n)})})}function U(e,t){var n="ALTER TABLE "+k+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(n,[],t)}function F(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,n){var o=n.rows.item(0).hex;V=2===o.length?"UTF-8":"UTF-16",t()})}function B(){for(;K.length>0;){var e=K.pop();e(null,H)}}function z(e,t){if(0===t){var n="CREATE TABLE IF NOT EXISTS "+S+" (dbid, db_version INTEGER)",o="CREATE TABLE IF NOT EXISTS "+k+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",r="CREATE TABLE IF NOT EXISTS "+q+" (digest, seq INTEGER)",i="CREATE TABLE IF NOT EXISTS "+w+" (id unique, json, winningseq)",a="CREATE TABLE IF NOT EXISTS "+_+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",l="CREATE TABLE IF NOT EXISTS "+E+" (id UNIQUE, rev, json)";e.executeSql(o),e.executeSql(l),e.executeSql(r,[],function(){e.executeSql(L),e.executeSql(j)}),e.executeSql(i,[],function(){e.executeSql(T),e.executeSql(a,[],function(){e.executeSql(A),e.executeSql(O),e.executeSql(n,[],function(){var t="INSERT INTO "+S+" (db_version, dbid) VALUES (?,?)";H=p.uuid();var n=[x,H];e.executeSql(t,n,function(){B()})})})})}else{var s=function(){var n=x>t;n&&e.executeSql("UPDATE "+S+" SET db_version = "+x);var o="SELECT dbid FROM "+S;e.executeSql(o,[],function(e,t){H=t.rows.item(0).dbid,B()})},c=[v,I,D,N,U,s],d=t,u=function(e){c[d-1](e,u),d++};u(e)}}function M(){Y.transaction(function(e){F(e,function(){P(e)})},l(t),o)}function P(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+S;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+S,[],function(e,t){var n=t.rows.item(0).db_version;z(e,n)}):e.executeSql("ALTER TABLE "+S+" ADD COLUMN db_version INTEGER",[],function(){z(e,1)}):z(e,0)})}function G(e,t){if(-1!==Q)return t(Q);var n=a("COUNT("+w+".id) AS 'num'",[w,_],C,_+".deleted=0");e.executeSql(n,[],function(e,n){Q=n.rows.item(0).num,t(Q)})}var V,J=this,H=null,X=e.name,W=d(e),K=[],Q=-1,Y=m(X,y,X,W);return Y?("function"!=typeof Y.readTransaction&&(Y.readTransaction=Y.transaction),p.isCordova()&&"undefined"!=typeof n?n.addEventListener(X+"_pouch",function Z(){n.removeEventListener(X+"_pouch",Z,!1),M()},!1):M(),J.type=function(){return"websql"},J._id=p.toPromise(function(e){e(null,H)}),J._info=function(e){Y.readTransaction(function(t){G(t,function(n){var o="SELECT MAX(seq) AS seq FROM "+_;t.executeSql(o,[],function(t,o){var r=o.rows.item(0).seq||0;e(null,{doc_count:n,update_seq:r})})})},l(e))},J._bulkDocs=function(e,t,n){function o(){var e=I.map(function(e){if(e._bulk_seq)delete e._bulk_seq;else if(!Object.keys(e).length)return{ok:!0};if(e.error)return e;var t=e.metadata,n=f.winningRev(t);return{ok:!0,id:t.id,rev:n}});u.Changes.notify(X),n(null,e)}function i(e,t){var n="SELECT count(*) as cnt FROM "+k+" WHERE digest=?";R.executeSql(n,[e],function(n,o){if(0===o.rows.item(0).cnt){var r=new Error("unknown stub attachment with digest "+e);r.status=412,t(r)}else t()})}function c(e){function t(){++r===n.length&&e(o)}var n=[];if(j.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var o=e.data._attachments[t];o.stub&&n.push(o.digest)})}),!n.length)return e();var o,r=0;n.forEach(function(e){i(e,function(e){e&&!o&&(o=e),t()})})}function d(e,t){if(e.stub)return t();if("string"==typeof e.data){try{e.data=atob(e.data)}catch(o){var r=b.error(b.BAD_ARG,"Attachments need to be base64 encoded");return n(r)}var i=p.fixBinary(e.data);e.data=p.createBlob([i],{type:e.content_type})}p.readAsBinaryString(e.data,function(n){e.data=n,p.MD5(n).then(function(o){e.digest="md5-"+o,e.length=n.length,t()})})}function g(e){function t(){n++,j.length===n&&e()}if(!j.length)return e();var n=0;j.forEach(function(e){function n(){r++,r===o.length&&t()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],r=0;if(!o.length)return t();for(var i in e.data._attachments)e.data._attachments.hasOwnProperty(i)&&d(e.data._attachments[i],n)})}function v(e,t,n,o,r,i){function l(){function t(e,t){function n(){return++i===a.length&&t(),!1}function r(t){var r="INSERT INTO "+q+" (digest, seq) VALUES (?,?)",i=[o._attachments[t].digest,e];R.executeSql(r,i,n,n)}var i=0,a=Object.keys(o._attachments||{});if(!a.length)return t();for(var l=0;l<a.length;l++)r(a[l])}var o=e.data,r=n?1:0,i=o._id,l=o._rev,c=s(o),d="INSERT INTO "+_+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",p=[i,l,c,r];R.executeSql(d,p,function(e,n){var o=n.insertId;t(o,function(){u(e,o)})},function(){var e=a("seq",_,null,"doc_id=? AND rev=?");return R.executeSql(e,[i,l],function(e,n){var o=n.rows.item(0).seq,a="UPDATE "+_+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",s=[c,r,i,l];e.executeSql(a,s,function(e){t(o,function(){u(e,o)})})}),!1})}function c(e){p||(e?(p=e,o(p)):f===b.length&&l())}function d(e){f++,c(e)}function u(n,a){e.metadata.seq=a,delete e.metadata.rev;var l=r?"UPDATE "+w+" SET json=?, winningseq=(SELECT seq FROM "+_+" WHERE doc_id="+w+".id AND rev=?) WHERE id=?":"INSERT INTO "+w+" (id, winningseq, json) VALUES (?, ?, ?);",s=h.stringify(e.metadata),c=e.metadata.id,d=r?[s,t,c]:[c,a,s];n.executeSql(l,d,function(){I[i]=e,D.set(c,e.metadata),o()})}var p=null,f=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev,n&&(e.data._deleted=!0);var b=e.data._attachments?Object.keys(e.data._attachments):[];for(var g in e.data._attachments)if(e.data._attachments[g].stub)f++,c();else{var v=e.data._attachments[g].data;delete e.data._attachments[g].data;var m=e.data._attachments[g].digest;O(m,v,d)}b.length||l()}function m(e,t,n,o){if(p.revExists(e,t.metadata.rev))return I[n]=t,void o();var r=f.merge(e.rev_tree,t.metadata.rev_tree[0],1e3),i=p.isDeleted(e),a=p.isDeleted(t.metadata),l=i&&a&&T||!i&&T&&"new_leaf"!==r.conflicts||i&&!a&&"new_branch"===r.conflicts;if(l)return I[n]=A(b.REV_CONFLICT,t._bulk_seq),o();t.metadata.rev_tree=r.tree;var s=f.winningRev(t.metadata);a=p.isDeleted(t.metadata,s),v(t,s,a,o,!0,n)}function y(e,n,o){var r=f.winningRev(e.metadata),i=p.isDeleted(e.metadata,r);return"was_delete"in t&&i?(I[n]=b.MISSING_DOC,o()):void v(e,r,i,o,!1,n)}function x(){++N===j.length&&o()}function E(){if(!j.length)return o();var e=new p.Map;j.forEach(function(t,n){if(t._id&&p.isLocalId(t._id))return void J[t._deleted?"_removeLocal":"_putLocal"](t,{ctx:R},function(e){I[n]=e?e:{},x()});var o=t.metadata.id;e.has(o)?e.get(o).push([t,n]):e.set(o,[[t,n]])}),e.forEach(function(e,t){function n(){x(),++r<e.length&&o()}function o(){var o=e[r],i=o[0],a=o[1];D.has(t)?m(D.get(t),i,a,n):y(i,a,n)}var r=0;o()})}function S(e){function t(){++n===j.length&&e()}if(!j.length)return e();var n=0;j.forEach(function(e){if(e._id&&p.isLocalId(e._id))return t();var n=e.metadata.id;R.executeSql("SELECT json FROM "+w+" WHERE id = ?",[n],function(e,o){if(o.rows.length){var r=h.parse(o.rows.item(0).json);D.set(n,r)}t()})})}function A(e,t){return e._bulk_seq=t,e}function O(e,t,n){var o="SELECT digest FROM "+k+" WHERE digest=?";R.executeSql(o,[e],function(i,a){return a.rows.length?n():(o="INSERT INTO "+k+" (digest, body, escaped) VALUES (?,?,1)",void i.executeSql(o,[e,r(t)],function(){n()},function(){return n(),!1}))})}var T=t.new_edits,L=e.docs,j=L.map(function(e,t){if(e._id&&p.isLocalId(e._id))return e;var n=p.parseDoc(e,T);return n._bulk_seq=t,n}),C=j.filter(function(e){return e.error});if(C.length)return n(C[0]);var R,I=new Array(j.length),D=new p.Map,N=0;g(function(){Y.transaction(function(e){R=e,c(function(e){return e?n(e):void S(E)})},l(n),function(){Q=-1})})},J._get=function(e,t,n){function o(){n(l,{doc:r,metadata:i,ctx:u})}t=p.clone(t);var r,i,l;if(!t.ctx)return void Y.readTransaction(function(o){t.ctx=o,J._get(e,t,n)});var s,d,u=t.ctx;t.rev?(s=a(R,[w,_],w+".id="+_+".doc_id",[_+".doc_id=?",_+".rev=?"]),d=[e,t.rev]):(s=a(R,[w,_],C,w+".id=?"),d=[e]),u.executeSql(s,d,function(e,n){if(!n.rows.length)return l=b.MISSING_DOC,o();var a=n.rows.item(0);return i=h.parse(a.metadata),a.deleted&&!t.rev?(l=b.error(b.MISSING_DOC,"deleted"),o()):(r=c(a.data,i.id,a.rev),void o())})},J._allDocs=function(e,t){var n,o=[],r="startkey"in e?e.startkey:!1,i="endkey"in e?e.endkey:!1,s="key"in e?e.key:!1,d="descending"in e?e.descending:!1,u="limit"in e?e.limit:-1,p="skip"in e?e.skip:0,b=e.inclusive_end!==!1,g=[],v=[];if(s!==!1)v.push(w+".id = ?"),g.push(s);else if(r!==!1||i!==!1){if(r!==!1&&(v.push(w+".id "+(d?"<=":">=")+" ?"),g.push(r)),i!==!1){var m=d?">":"<";b&&(m+="="),v.push(w+".id "+m+" ?"),g.push(i)}s!==!1&&(v.push(w+".id = ?"),g.push(s))}"ok"!==e.deleted&&v.push(_+".deleted = 0"),Y.readTransaction(function(t){G(t,function(r){if(n=r,0!==u){var i=a(R,[w,_],C,v,w+".id "+(d?"DESC":"ASC"));i+=" LIMIT "+u+" OFFSET "+p,t.executeSql(i,g,function(t,n){for(var r=0,i=n.rows.length;i>r;r++){var a=n.rows.item(r),l=h.parse(a.metadata),s=c(a.data,l.id,a.rev),d=s._rev,u={id:l.id,key:l.id,value:{rev:d}};if(e.include_docs){u.doc=s,u.doc._rev=d,e.conflicts&&(u.doc._conflicts=f.collectConflicts(l));for(var p in u.doc._attachments)u.doc._attachments.hasOwnProperty(p)&&(u.doc._attachments[p].stub=!0)}if(a.deleted){if("ok"!==e.deleted)continue;u.value.deleted=!0,u.doc=null}o.push(u)}})}})},l(t),function(){t(null,{total_rows:n,offset:e.skip,rows:o})})},J._changes=function(e){function t(){var t=[w+".winningseq > "+e.since],n=[];e.doc_ids&&(t.push(w+".id IN ("+e.doc_ids.map(function(){return"?"}).join(",")+")"),n=e.doc_ids);var d=a(R,[w,_],C,t,w+".winningseq "+(o?"DESC":"ASC")),u=p.filterChange(e);e.view||e.filter||(d+=" LIMIT "+r),Y.readTransaction(function(t){t.executeSql(d,n,function(t,n){for(var o=0,a=0,d=n.rows.length;d>a;a++){var p=n.rows.item(a),f=h.parse(p.metadata);o<p.seq&&(o=p.seq);var b=c(p.data,f.id,p.rev),g=e.processChange(b,f,e);if(g.seq=p.seq,u(g)&&(s++,i&&l.push(g),e.onChange(g)),s===r)break}e.continuous||e.complete(null,{results:l,last_seq:o})})})}if(e=p.clone(e),e.continuous){var n=X+":"+p.uuid();return u.Changes.addListener(X,n,J,e),u.Changes.notify(X),{cancel:function(){u.Changes.removeListener(X,n)}}}var o=e.descending;e.since=e.since&&!o?e.since:0;var r="limit"in e?e.limit:-1;0===r&&(r=1);var i;i="returnDocs"in e?e.returnDocs:!0;var l=[],s=0;t()},J._close=function(e){e()},J._getAttachment=function(e,t,n){var o,r=t.ctx,a=e.digest,l=e.content_type,s="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+k+" WHERE digest=?";r.executeSql(s,[a],function(e,r){var a=r.rows.item(0),s=a.escaped?i(a.body):g(a.body,V);t.encode?o=btoa(s):(s=p.fixBinary(s),o=p.createBlob([s],{type:l})),n(null,o)})},J._getRevisionTree=function(e,t){Y.readTransaction(function(n){var o="SELECT json AS metadata FROM "+w+" WHERE id = ?";n.executeSql(o,[e],function(e,n){if(n.rows.length){var o=h.parse(n.rows.item(0).metadata);t(null,o.rev_tree)}else t(b.MISSING_DOC)})})},J._doCompaction=function(e,t,n){return t.length?void Y.transaction(function(n){var o="SELECT json AS metadata FROM "+w+" WHERE id = ?";n.executeSql(o,[e],function(n,o){var r=h.parse(o.rows.item(0).metadata);f.traverseRevTree(r.rev_tree,function(e,n,o,r,i){var a=n+"-"+o;-1!==t.indexOf(a)&&(i.status="missing")});var i="UPDATE "+w+" SET json = ? WHERE id = ?";n.executeSql(i,[h.stringify(r),e])}),t.forEach(function(t){var o="SELECT seq FROM "+_+" WHERE doc_id=? AND rev=?";n.executeSql(o,[e,t],function(e,t){if(t.rows.length){var n=t.rows.item(0).seq,o="SELECT a1.digest AS digest FROM "+q+" a1 JOIN "+q+" a2 ON a1.digest=a2.digest WHERE a1.seq=? GROUP BY a1.digest HAVING COUNT(*) = 1";e.executeSql(o,[n],function(e,t){for(var o=[],r=0;r<t.rows.length;r++)o.push(t.rows.item(r).digest);e.executeSql("DELETE FROM "+_+" WHERE seq=?",[n]),e.executeSql("DELETE FROM "+q+" WHERE seq=?",[n]),o.forEach(function(t){e.executeSql("DELETE FROM "+q+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+k+" WHERE digest=?",[t])})})}})})},l(n),function(){n()}):n()},J._getLocal=function(e,t){Y.readTransaction(function(n){var o="SELECT json, rev FROM "+E+" WHERE id=?";n.executeSql(o,[e],function(n,o){if(o.rows.length){var r=o.rows.item(0),i=c(r.json,e,r.rev);
t(null,i)}else t(b.MISSING_DOC)})})},J._putLocal=function(e,t,n){function o(e){var o,l;i?(o="UPDATE "+E+" SET rev=?, json=? WHERE id=? AND rev=?",l=[r,d,a,i]):(o="INSERT INTO "+E+" (id, rev, json) VALUES (?,?,?)",l=[a,r,d]),e.executeSql(o,l,function(e,o){o.rowsAffected?(c={ok:!0,id:a,rev:r},t.ctx&&n(null,c)):n(b.REV_CONFLICT)},function(){return n(b.REV_CONFLICT),!1})}"function"==typeof t&&(n=t,t={}),delete e._revisions;var r,i=e._rev,a=e._id;r=e._rev=i?"0-"+(parseInt(i.split("-")[1],10)+1):"0-1";var c,d=s(e);t.ctx?o(t.ctx):Y.transaction(function(e){o(e)},l(n),function(){c&&n(null,c)})},void(J._removeLocal=function(e,t){var n;Y.transaction(function(o){var r="DELETE FROM "+E+" WHERE id=? AND rev=?",i=[e._id,e._rev];o.executeSql(r,i,function(o,r){return r.rowsAffected?void(n={ok:!0,id:e._id,rev:"0-0"}):t(b.REV_CONFLICT)})},l(t),function(){t(null,n)})})):t(b.UNKNOWN_ERROR)}var p=e("../utils"),f=e("../merge"),b=e("../deps/errors"),h=e("vuvuzela"),g=e("../deps/parse-hex"),v={},m=p.getArguments(function(e){if("undefined"!=typeof n){if(n.navigator&&n.navigator.sqlitePlugin&&n.navigator.sqlitePlugin.openDatabase)return navigator.sqlitePlugin.openDatabase.apply(navigator.sqlitePlugin,e);if(n.sqlitePlugin&&n.sqlitePlugin.openDatabase)return n.sqlitePlugin.openDatabase.apply(n.sqlitePlugin,e);var t=v[e[0]];return t||(t=v[e[0]]=n.openDatabase.apply(n,e)),t}}),y=1,x=6,w=o("document-store"),_=o("by-sequence"),k=o("attach-store"),E=o("local-store"),S=o("metadata-store"),q=o("attach-seq-store"),A="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+_+" (seq, deleted)",O="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+_+" (doc_id, rev)",T="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+w+" (winningseq)",L="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+q+" (seq)",j="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+q+" (digest, seq)",C=_+".seq = "+w+".winningseq",R=_+".seq AS seq, "+_+".deleted AS deleted, "+_+".json AS data, "+_+".rev AS rev, "+w+".json AS metadata";u.valid=function(){if("undefined"!=typeof n){if(n.navigator&&n.navigator.sqlitePlugin&&n.navigator.sqlitePlugin.openDatabase)return!0;if(n.sqlitePlugin&&n.sqlitePlugin.openDatabase)return!0;if(n.openDatabase)return!0}return!1},u.destroy=p.toPromise(function(e,t,o){u.Changes.removeAllListeners(e);var r=d(t),i=m(e,y,e,r);i.transaction(function(e){var t=[w,_,k,S,E,q];t.forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},l(o),function(){p.hasLocalStorage()&&(delete n.localStorage["_pouch__websqldb_"+e],delete n.localStorage[e]),o(null,{ok:!0})})}),u.Changes=new p.Changes,t.exports=u}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../deps/errors":12,"../deps/parse-hex":14,"../merge":21,"../utils":26,vuvuzela:61}],6:[function(e,t){"use strict";function n(e,t,n){function o(){i.cancel()}l.call(this);var i=this;this.db=e,t=t?r.clone(t):{};var a=n||t.complete||function(){},s=t.complete=r.once(function(t,n){t?i.emit("error",t):i.emit("complete",n),i.removeAllListeners(),e.removeListener("destroyed",o)});a&&(i.on("complete",function(e){a(null,e)}),i.on("error",function(e){a(e)}));var c=t.onChange;c&&i.on("change",c),e.once("destroyed",o),t.onChange=function(e){t.isCancelled||(i.emit("change",e),i.startSeq&&i.startSeq<=e.seq&&(i.emit("uptodate"),i.startSeq=!1),e.deleted?i.emit("delete",e):1===e.changes.length&&"1-"===e.changes[0].rev.slice(0,2)?i.emit("create",e):i.emit("update",e))};var d=new r.Promise(function(e,n){t.complete=function(t,o){t?n(t):e(o)}});i.once("cancel",function(){c&&i.removeListener("change",c),t.complete(null,{status:"cancelled"})}),this.then=d.then.bind(d),this["catch"]=d["catch"].bind(d),this.then(function(e){s(null,e)},s),e.taskqueue.isReady?i.doChanges(t):e.taskqueue.addTask(function(){i.isCancelled?i.emit("cancel"):i.doChanges(t)})}function o(e,t,n){var o=[{rev:e._rev}];"all_docs"===n.style&&(o=i.collectLeaves(t.rev_tree).map(function(e){return{rev:e.rev}}));var a={id:t.id,changes:o,doc:e};return r.isDeleted(t,e._rev)&&(a.deleted=!0),n.conflicts&&(a.doc._conflicts=i.collectConflicts(t),a.doc._conflicts.length||delete a.doc._conflicts),a}var r=e("./utils"),i=e("./merge"),a=e("./deps/errors"),l=e("events").EventEmitter,s=e("./evalFilter"),c=e("./evalView");t.exports=n,r.inherits(n,l),n.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},n.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=r.clone(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=o,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"===e.since)return void this.db.info().then(function(o){return t.isCancelled?void n(null,{status:"cancelled"}):(e.since=o.update_seq-1,void t.doChanges(e))},n);if(e.continuous&&"now"!==e.since&&this.db.info().then(function(e){t.startSeq=e.update_seq-1},function(e){if("idbNull"!==e.id)throw e}),"http"!==this.db.type()&&e.filter&&"string"==typeof e.filter)return this.filterChanges(e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var i=this.db._changes(e);if(i&&"function"==typeof i.cancel){var a=t.cancel;t.cancel=r.getArguments(function(e){i.cancel(),a.apply(this,e)})}},n.prototype.filterChanges=function(e){var t=this,n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var o=new Error("`view` filter parameter is not provided.");return o.status=a.BAD_REQUEST.status,o.name=a.BAD_REQUEST.name,o.error=!0,void n(o)}var r=e.view.split("/");this.db.get("_design/"+r[0],function(o,i){if(t.isCancelled)return void n(null,{status:"cancelled"});if(o)return void n(o);if(i&&i.views&&i.views[r[1]]){var l=c(i.views[r[1]].map);return e.filter=l,void t.doChanges(e)}var s=i.views?"missing json key: "+r[1]:"missing json key: views";o||(o=new Error(s),o.status=a.MISSING_DOC.status,o.name=a.MISSING_DOC.name,o.error=!0),n(o)})}else{var i=e.filter.split("/");this.db.get("_design/"+i[0],function(o,r){if(t.isCancelled)return void n(null,{status:"cancelled"});if(o)return void n(o);if(r&&r.filters&&r.filters[i[1]]){var l=s(r.filters[i[1]]);return e.filter=l,void t.doChanges(e)}var c=r&&r.filters?"missing json key: "+i[1]:"missing json key: filters";return o||(o=new Error(c),o.status=a.MISSING_DOC.status,o.name=a.MISSING_DOC.name,o.error=!0),void n(o)})}}},{"./deps/errors":12,"./evalFilter":18,"./evalView":19,"./merge":21,"./utils":26,events:30}],7:[function(e,t){"use strict";function n(e,t,n,o){return e.get(t)["catch"](function(n){if(404===n.status)return"http"===e.type()&&r.explain404("PouchDB is just checking if a remote checkpoint exists."),{_id:t};throw n}).then(function(t){return o.cancelled?void 0:(t.last_seq=n,e.put(t))})}function o(e,t,n,o){this.src=e,this.target=t,this.id=n,this.returnValue=o}var r=e("./utils");o.prototype.writeCheckpoint=function(e){var t=this;return this.updateTarget(e).then(function(){return t.updateSource(e)})},o.prototype.updateTarget=function(e){return n(this.target,this.id,e,this.returnValue)},o.prototype.updateSource=function(e){var t=this;return this.readOnlySource?r.Promise.resolve(!0):n(this.src,this.id,e,this.returnValue)["catch"](function(e){var n="number"==typeof e.status&&4===Math.floor(e.status/100);if(n)return t.readOnlySource=!0,!0;throw e})},o.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.src.get(e.id).then(function(e){return t.last_seq===e.last_seq?e.last_seq:0},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:0}).then(function(){return 0},function(n){return 401===n.status?(e.readOnlySource=!0,t.last_seq):0});throw n})})["catch"](function(e){if(404!==e.status)throw e;return 0})},t.exports=o},{"./utils":26}],8:[function(e,t){(function(n){"use strict";function o(e){e&&n.debug&&console.error(e)}function r(e,t,n){if(!(this instanceof r))return new r(e,t,n);var c=this;("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),e&&"object"==typeof e&&(t=e,e=void 0),"undefined"==typeof n&&(n=o),t=t||{},this.__opts=t;var d=n;c.auto_compaction=t.auto_compaction,c.prefix=r.prefix,i.call(c),c.taskqueue=new l;var u=new s(function(o,i){n=function(e,t){return e?i(e):(delete t.then,void o(t))},t=a.clone(t);var l,s,d=t.name||e;return function(){try{if("string"!=typeof d)throw s=new Error("Missing/invalid DB name"),s.code=400,s;if(l=r.parseAdapter(d,t),t.originalName=d,t.name=l.name,t.prefix&&"http"!==l.adapter&&"https"!==l.adapter&&(t.name=t.prefix+t.name),t.adapter=t.adapter||l.adapter,c._adapter=t.adapter,c._db_name=d,!r.adapters[t.adapter])throw s=new Error("Adapter is missing"),s.code=404,s;if(!r.adapters[t.adapter].valid())throw s=new Error("Invalid Adapter"),s.code=404,s}catch(e){c.taskqueue.fail(e),c.changes=a.toPromise(function(t){t.complete&&t.complete(e)})}}(),s?i(s):(c.adapter=t.adapter,c.replicate={},c.replicate.from=function(e,t,n){return c.constructor.replicate(e,c,t,n)},c.replicate.to=function(e,t,n){return c.constructor.replicate(c,e,t,n)},c.sync=function(e,t,n){return c.constructor.sync(c,e,t,n)},c.replicate.sync=c.sync,c.destroy=a.adapterFun("destroy",function(e){var t=this;t.info(function(n,o){return n?e(n):void t.constructor.destroy(o.db_name,e)})}),r.adapters[t.adapter].call(c,t,function(e){function o(e){"destroyed"===e&&(c.emit("destroyed"),r.removeListener(d,o))}return e?void(n&&(c.taskqueue.fail(e),n(e))):(r.on(d,o),c.emit("created",c),r.emit("created",t.originalName),c.taskqueue.ready(c),void n(null,c))}),t.skipSetup&&c.taskqueue.ready(c),void(a.isCordova()&&cordova.fireWindowEvent(t.name+"_pouch",{})))});u.then(function(e){d(null,e)},d),c.then=u.then.bind(u),c["catch"]=u["catch"].bind(u)}var i=e("./adapter"),a=e("./utils"),l=e("./taskqueue"),s=a.Promise;a.inherits(r,i),t.exports=r}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter":1,"./taskqueue":25,"./utils":26}],9:[function(e,t){"use strict";function n(e,t){function n(t,n,o){if(e.binary||e.json||!e.processData||"string"==typeof t){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(r){return o(r)}}else t=JSON.stringify(t);Array.isArray(t)&&(t=t.map(function(e){var t;return e.ok?e:e.error&&"conflict"===e.error?(t=i.REV_CONFLICT,t.id=e.id,t):e.error&&"forbidden"===e.error?(t=i.FORBIDDEN,t.id=e.id,t.reason=e.reason,t):e.missing?(t=i.MISSING_DOC,t.missing=e.missing,t):e})),o(null,t,n)}function l(e,t){var n,o,r,a;try{n=JSON.parse(e.responseText);for(a in i)if(i.hasOwnProperty(a)&&i[a].name===n.error){r=i[a];break}r||(r=i.UNKNOWN_ERROR,e.status&&(r.status=e.status),e.statusText&&(e.name=e.statusText)),o=i.error(r,n.reason)}catch(l){for(var a in i)if(i.hasOwnProperty(a)&&i[a].status===e.status){r=i[a];break}r||(r=i.UNKNOWN_ERROR,e.status&&(r.status=e.status),e.statusText&&(e.name=e.statusText)),o=i.error(r)}e.withCredentials&&0===e.status&&(o.status=405,o.statusText="Method Not Allowed"),t(o)}var s=!1,c=a.getArguments(function(e){s||(t.apply(this,e),s=!0)});"function"==typeof e&&(c=e,e={}),e=a.clone(e);var d={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};if(e=a.extend(!0,d,e),"GET"===e.method&&!e.cache){var u=-1!==e.url.indexOf("?");e.url+=(u?"&":"?")+"_nonce="+a.uuid(16)}var p,f;f=e.xhr?new e.xhr:new XMLHttpRequest,f.open(e.method,e.url),f.withCredentials=!0,e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(f.responseType="arraybuffer");var b=function(e,t,n){var o="";if(n){var r=new Date;r.setTime(r.getTime()+24*n*60*60*1e3),o="; expires="+r.toGMTString()}document.cookie=e+"="+t+o+"; path=/"};for(var h in e.headers)if("Cookie"===h){var g=e.headers[h].split("=");b(g[0],g[1],10)}else f.setRequestHeader(h,e.headers[h]);"body"in e||(e.body=null);var v=function(){s||(f.abort(),l(f,c))};return f.onreadystatechange=function(){if(4===f.readyState&&!s)if(clearTimeout(p),f.status>=200&&f.status<300){var t;t=e.binary?r([f.response||""],{type:f.getResponseHeader("Content-Type")}):f.responseText,n(t,f,c)}else l(f,c)},e.timeout>0&&(p=setTimeout(v,e.timeout),f.onprogress=function(){clearTimeout(p),p=setTimeout(v,e.timeout)},"undefined"==typeof o&&(o=-1!==Object.keys(f).indexOf("upload")),o&&(f.upload.onprogress=f.onprogress)),e.body&&e.body instanceof Blob?a.readAsBinaryString(e.body,function(e){f.send(a.fixBinary(e))}):f.send(e.body),{abort:v}}var o,r=e("./blob.js"),i=e("./errors"),a=e("../utils");t.exports=n},{"../utils":26,"./blob.js":10,"./errors":12}],10:[function(e,t){(function(e){"use strict";function n(t,n){t=t||[],n=n||{};try{return new Blob(t,n)}catch(o){if("TypeError"!==o.name)throw o;for(var r=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,i=new r,a=0;a<t.length;a+=1)i.append(t[a]);return i.getBlob(n.type)}}t.exports=n}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],11:[function(e,t,n){"use strict";function o(){this.store={}}function r(){this.store=new o}n.Map=o,n.Set=r,o.prototype.mangle=function(e){if("string"!=typeof e)throw new TypeError("key must be a string but Got "+e);return"$"+e},o.prototype.unmangle=function(e){return e.substring(1)},o.prototype.get=function(e){var t=this.mangle(e);return t in this.store?this.store[t]:void 0},o.prototype.set=function(e,t){var n=this.mangle(e);return this.store[n]=t,!0},o.prototype.has=function(e){var t=this.mangle(e);return t in this.store},o.prototype["delete"]=function(e){var t=this.mangle(e);return t in this.store?(delete this.store[t],!0):!1},o.prototype.forEach=function(e){var t=this,n=Object.keys(t.store);n.forEach(function(n){var o=t.store[n];n=t.unmangle(n),e(o,n)})},r.prototype.add=function(e){return this.store.set(e,!0)},r.prototype.has=function(e){return this.store.has(e)},r.prototype["delete"]=function(e){return this.store["delete"](e)}},{}],12:[function(e,t,n){"use strict";function o(e){this.status=e.status,this.name=e.error,this.message=e.reason,this.error=!0}o.prototype__proto__=Error.prototype,o.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message})},n.UNAUTHORIZED=new o({status:401,error:"unauthorized",reason:"Name or password is incorrect."}),n.MISSING_BULK_DOCS=new o({status:400,error:"bad_request",reason:"Missing JSON list of 'docs'"}),n.MISSING_DOC=new o({status:404,error:"not_found",reason:"missing"}),n.REV_CONFLICT=new o({status:409,error:"conflict",reason:"Document update conflict"}),n.INVALID_ID=new o({status:400,error:"invalid_id",reason:"_id field must contain a string"}),n.MISSING_ID=new o({status:412,error:"missing_id",reason:"_id is required for puts"}),n.RESERVED_ID=new o({status:400,error:"bad_request",reason:"Only reserved document ids may start with underscore."}),n.NOT_OPEN=new o({status:412,error:"precondition_failed",reason:"Database not open"}),n.UNKNOWN_ERROR=new o({status:500,error:"unknown_error",reason:"Database encountered an unknown error"}),n.BAD_ARG=new o({status:500,error:"badarg",reason:"Some query argument is invalid"}),n.INVALID_REQUEST=new o({status:400,error:"invalid_request",reason:"Request was invalid"}),n.QUERY_PARSE_ERROR=new o({status:400,error:"query_parse_error",reason:"Some query parameter is invalid"}),n.DOC_VALIDATION=new o({status:500,error:"doc_validation",reason:"Bad special document member"}),n.BAD_REQUEST=new o({status:400,error:"bad_request",reason:"Something wrong with the request"}),n.NOT_AN_OBJECT=new o({status:400,error:"bad_request",reason:"Document must be a JSON object"}),n.DB_MISSING=new o({status:404,error:"not_found",reason:"Database not found"}),n.IDB_ERROR=new o({status:500,error:"indexed_db_went_bad",reason:"unknown"}),n.WSQ_ERROR=new o({status:500,error:"web_sql_went_bad",reason:"unknown"}),n.LDB_ERROR=new o({status:500,error:"levelDB_went_went_bad",reason:"unknown"}),n.FORBIDDEN=new o({status:403,error:"forbidden",reason:"Forbidden by design doc validate_doc_update function"}),n.error=function(e,t,n){function o(){this.message=t,n&&(this.name=n)}return o.prototype=e,new o(t)}},{}],13:[function(e,t){(function(n,o){"use strict";function r(e,t,n){if("function"==typeof e.slice)return t?n?e.slice(t,n):e.slice(t):e.slice();t=Math.floor(t||0),n=Math.floor(n||0);var o=e.byteLength;if(t=0>t?Math.max(t+o,0):Math.min(o,t),n=0>n?Math.max(n+o,0):Math.min(o,n),0>=n-t)return new ArrayBuffer(0);var r=new ArrayBuffer(n-t),i=new Uint8Array(r),a=new Uint8Array(e,t,n-t);return i.set(a),r}function i(e){var t=[255&e,e>>>8&255,e>>>16&255,e>>>24&255];return t.map(function(e){return String.fromCharCode(e)}).join("")}function a(e){for(var t="",n=0;n<e.length;n++)t+=i(e[n]);return o.btoa(t)}var l=e("crypto"),s=e("spark-md5"),c=o.setImmediate||o.setTimeout,d=32768;t.exports=function(e,t){function o(e,t,n,o){p?e.appendBinary(t.substring(n,o)):e.append(r(t,n,o))}function i(){var n=g*b,r=n+b;if(n+b>=e.size&&(r=e.size),g++,h>g)o(v,e,n,r),c(i);else{o(v,e,n,r);var l=v.end(!0),s=a(l);t(null,s),v.destroy()}}if(!n.browser){var u=l.createHash("md5").update(e).digest("base64");return void t(null,u)}var p="string"==typeof e,f=p?e.length:e.byteLength,b=Math.min(d,f),h=Math.ceil(f/b),g=0,v=p?new s:new s.ArrayBuffer;i()}}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31,crypto:29,"spark-md5":60}],14:[function(e,t){"use strict";function n(e){return decodeURIComponent(window.escape(e))}function o(e){return 65>e?e-48:e-55}function r(e,t,n){for(var r="";n>t;)r+=String.fromCharCode(o(e.charCodeAt(t++))<<4|o(e.charCodeAt(t++)));return r}function i(e,t,n){for(var r="";n>t;)r+=String.fromCharCode(o(e.charCodeAt(t+2))<<12|o(e.charCodeAt(t+3))<<8|o(e.charCodeAt(t))<<4|o(e.charCodeAt(t+1))),t+=4;return r}function a(e,t){return"UTF-8"===t?n(r(e,0,e.length)):i(e,0,e.length)}t.exports=a},{}],15:[function(e,t){"use strict";function n(e){for(var t=o,n=t.parser[t.strictMode?"strict":"loose"].exec(e),r={},i=14;i--;){var a=t.key[i],l=n[i]||"",s=-1!==["user","password"].indexOf(a);r[a]=s?decodeURIComponent(l):l}return r[t.q.name]={},r[t.key[12]].replace(t.q.parser,function(e,n,o){n&&(r[t.q.name][n]=o)}),r}var o={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};t.exports=n},{}],16:[function(e,t){"use strict";function n(e,t,n){return new r(function(r,i){return t&&"object"==typeof t&&(t=t._id),"string"!=typeof t?i(new Error("doc id is required")):void e.get(t,function(a,l){if(a)return 404!==a.status?i(a):r(o(e,n({_id:t}),n));var s=n(l);return s?void r(o(e,s,n)):r(l)})})}function o(e,t,o){return e.put(t)["catch"](function(r){if(409!==r.status)throw r;return n(e,t,o)})}var r=e("../utils").Promise;t.exports=function(e,t,o,r){return"function"!=typeof r?n(e,t,o):void n(e,t,o).then(function(e){r(null,e)},r)}},{"../utils":26}],17:[function(e,t){"use strict";function n(e){return 0|Math.random()*e}function o(e,t){t=t||r.length;var o="",i=-1;if(e){for(;++i<e;)o+=r[n(t)];return o}for(;++i<36;)switch(i){case 8:case 13:case 18:case 23:o+="-";break;case 19:o+=r[3&n(16)|8];break;default:o+=r[n(16)]}return o}/*!
	Math.uuid.js (v1.4)
	http://www.broofa.com
	mailto:robert@broofa.com
	
	Copyright (c) 2010 Robert Kieffer
	Dual licensed under the MIT and GPL licenses.
	*/
var r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");t.exports=o},{}],18:[function(_dereq_,module,exports){"use strict";function evalFilter(input){return eval(["(function () { return ",input," })()"].join(""))}module.exports=evalFilter},{}],19:[function(_dereq_,module,exports){"use strict";function evalView(input){return eval(["(function () {","  return function (doc) {","    var emitted = false;","    var emit = function (a, b) {","      emitted = true;","    };","    var view = "+input+";","    view(doc);","    if (emitted) {","      return true;","    }","  }","})()"].join("\n"))}module.exports=evalView},{}],20:[function(e,t){(function(n){"use strict";var o=e("./setup");t.exports=o,o.ajax=e("./deps/ajax"),o.extend=e("pouchdb-extend"),o.utils=e("./utils"),o.Errors=e("./deps/errors"),o.replicate=e("./replicate").replicate,o.sync=e("./sync"),o.version=e("./version");var r=e("./adapters/http");if(o.adapter("http",r),o.adapter("https",r),o.adapter("idb",e("./adapters/idb")),o.adapter("websql",e("./adapters/websql")),o.plugin(e("pouchdb-mapreduce")),!n.browser){var i=e("./adapters/leveldb");o.adapter("ldb",i),o.adapter("leveldb",i)}}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./adapters/http":2,"./adapters/idb":3,"./adapters/leveldb":29,"./adapters/websql":5,"./deps/ajax":9,"./deps/errors":12,"./replicate":22,"./setup":23,"./sync":24,"./utils":26,"./version":27,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31,"pouchdb-extend":51,"pouchdb-mapreduce":54}],21:[function(e,t){"use strict";function n(e){for(var t,n=e.shift(),o=[n.id,n.opts,[]],r=o;e.length;)n=e.shift(),t=[n.id,n.opts,[]],r[2].push(t),r=t;return o}function o(e,t){for(var n=[{tree1:e,tree2:t}],o=!1;n.length>0;){var r=n.pop(),i=r.tree1,a=r.tree2;(i[1].status||a[1].status)&&(i[1].status="available"===i[1].status||"available"===a[1].status?"available":"missing");for(var l=0;l<a[2].length;l++)if(i[2][0]){for(var s=!1,c=0;c<i[2].length;c++)i[2][c][0]===a[2][l][0]&&(n.push({tree1:i[2][c],tree2:a[2][l]}),s=!0);s||(o="new_branch",i[2].push(a[2][l]),i[2].sort())}else o="new_leaf",i[2][0]=a[2][l]}return{conflicts:o,tree:e}}function r(e,t,n){var r,i=[],a=!1,l=!1;return e.length?(e.forEach(function(e){if(e.pos===t.pos&&e.ids[0]===t.ids[0])r=o(e.ids,t.ids),i.push({pos:e.pos,ids:r.tree}),a=a||r.conflicts,l=!0;else if(n!==!0){var s=e.pos<t.pos?e:t,c=e.pos<t.pos?t:e,d=c.pos-s.pos,u=[],p=[];for(p.push({ids:s.ids,diff:d,parent:null,parentIdx:null});p.length>0;){var f=p.pop();0!==f.diff?f.ids&&f.ids[2].forEach(function(e,t){p.push({ids:e,diff:f.diff-1,parent:f.ids,parentIdx:t})}):f.ids[0]===c.ids[0]&&u.push(f)}var b=u[0];b?(r=o(b.ids,c.ids),b.parent[2][b.parentIdx]=r.tree,i.push({pos:s.pos,ids:s.ids}),a=a||r.conflicts,l=!0):i.push(e)}else i.push(e)}),l||i.push(t),i.sort(function(e,t){return e.pos-t.pos}),{tree:i,conflicts:a||"internal_node"}):{tree:[t],conflicts:"new_leaf"}}function i(e,t){var o=l.rootToLeaf(e).map(function(e){var o=e.ids.slice(-t);return{pos:e.pos+(e.ids.length-o.length),ids:n(o)}});return o.reduce(function(e,t){return r(e,t,!0).tree},[o.shift()])}var a=e("pouchdb-extend"),l={};l.merge=function(e,t,n){e=a(!0,[],e),t=a(!0,{},t);var o=r(e,t);return{tree:i(o.tree,n),conflicts:o.conflicts}},l.winningRev=function(e){var t=[];return l.traverseRevTree(e.rev_tree,function(e,n,o,r,i){e&&t.push({pos:n,id:o,deleted:!!i.deleted})}),t.sort(function(e,t){return e.deleted!==t.deleted?e.deleted>t.deleted?1:-1:e.pos!==t.pos?t.pos-e.pos:e.id<t.id?1:-1}),t[0].pos+"-"+t[0].id},l.traverseRevTree=function(e,t){for(var n,o=e.slice();n=o.pop();)for(var r=n.pos,i=n.ids,a=i[2],l=t(0===a.length,r,i[0],n.ctx,i[1]),s=0,c=a.length;c>s;s++)o.push({pos:r+1,ids:a[s],ctx:l})},l.collectLeaves=function(e){var t=[];return l.traverseRevTree(e,function(e,n,o,r,i){e&&t.unshift({rev:n+"-"+o,pos:n,opts:i})}),t.sort(function(e,t){return t.pos-e.pos}),t.map(function(e){delete e.pos}),t},l.collectConflicts=function(e){var t=l.winningRev(e),n=l.collectLeaves(e.rev_tree),o=[];return n.forEach(function(e){e.rev===t||e.opts.deleted||o.push(e.rev)}),o},l.rootToLeaf=function(e){var t=[];return l.traverseRevTree(e,function(e,n,o,r,i){if(r=r?r.slice(0):[],r.push({id:o,opts:i}),e){var a=n+1-r.length;t.unshift({pos:a,ids:r})}return r}),t},t.exports=l},{"pouchdb-extend":51}],22:[function(e,t,n){"use strict";function o(e,t){e=parseInt(e,10),t=parseInt(t,10),e!==e&&(e=0),t!==t||e>=t?t=(e||1)<<1:t+=1;var n=Math.random(),o=t-e;return~~(o*n+e)}function r(e){var t=0;return e||(t=2e3),o(e,t)}function i(e,t,n,o,i,a,l){return o.retry===!1?(i.emit("error",l),void i.removeAllListeners()):(o.default_back_off=o.default_back_off||0,o.retries=o.retries||0,"function"!=typeof o.back_off_function&&(o.back_off_function=r),o.retries++,o.max_retries&&o.retries>o.max_retries?(i.emit("error",new Error("tried "+o.retries+" times but replication failed")),void i.removeAllListeners()):(i.emit("requestError",l),"active"===i.state&&(i.emit("syncStopped"),i.state="stopped",i.once("syncRestarted",function(){o.current_back_off=o.default_back_off})),o.current_back_off=o.current_back_off||o.default_back_off,o.current_back_off=o.back_off_function(o.current_back_off),void setTimeout(function(){s(e,t,n,o,i)},o.current_back_off)))}function a(){p.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new u.Promise(function(t,n){e.once("complete",t),e.once("error",n)});e.then=function(e,n){return t.then(e,n)},e["catch"]=function(e){return t["catch"](e)},e["catch"](function(){})}function l(e,t,n){var o=n.filter?n.filter.toString():"";return e.id().then(function(e){return t.id().then(function(t){var r=e+t+o+JSON.stringify(n.query_params)+n.doc_ids;return u.MD5(r).then(function(e){return e=e.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+e})})})}function s(e,t,n,o,r,a){function l(){if(0!==q.docs.length){var e=q.docs;return n.bulkDocs({docs:e},{new_edits:!1}).then(function(e){if(F.cancelled)throw x(),new Error("cancelled");var t=[];e.forEach(function(e){if(e.error){a.doc_write_failures++;var n=new Error(e.reason||e.message||"Unknown reason");n.name=e.name||e.error,t.push(n)}}),a.errors=a.errors.concat(t),a.docs_written+=q.docs.length-t.length;var n=t.filter(function(e){return"unauthorized"!==e.name&&"forbidden"!==e.name});if(n.length>0){var o=new Error("bulkDocs error");throw o.other_errors=t,y("target.bulkDocs failed to write docs",o),new Error("bulkWrite partial failure")}},function(t){throw a.doc_write_failures+=e.length,t})}}function s(){for(var e=q.diffs,n=Object.keys(e)[0],o=e[n].missing,r=[],i=0;i<o.length;i+=b)r.push(o.slice(i,Math.min(o.length,i+b)));return u.Promise.all(r.map(function(o){return t.get(n,{revs:!0,open_revs:o,attachments:!0}).then(function(t){t.forEach(function(e){return F.cancelled?x():void(e.ok&&(a.docs_read++,q.pendingRevs++,q.docs.push(e.ok)))}),delete e[n]})}))}function c(){return Object.keys(q.diffs).length>0?s().then(c):u.Promise.resolve()}function d(){var e=Object.keys(q.diffs).filter(function(e){var t=q.diffs[e].missing;return 1===t.length&&"1-"===t[0].slice(0,2)});return t.allDocs({keys:e,include_docs:!0}).then(function(e){if(F.cancelled)throw x(),new Error("cancelled");e.rows.forEach(function(e){!e.doc||e.deleted||"1-"!==e.value.rev.slice(0,2)||e.doc._attachments&&0!==Object.keys(e.doc._attachments).length||(a.docs_read++,q.pendingRevs++,q.docs.push(e.doc),delete q.diffs[e.id])})})}function p(){return d().then(c)}function h(){return T=!0,B.writeCheckpoint(q.seq).then(function(){if(T=!1,F.cancelled)throw x(),new Error("cancelled");a.last_seq=C=q.seq,r.emit("change",u.clone(a)),q=void 0,E()})["catch"](function(e){throw T=!1,y("writeCheckpoint completed with error",e),e})}function g(){var e={};return q.changes.forEach(function(t){e[t.id]=t.changes.map(function(e){return e.rev})}),n.revsDiff(e).then(function(e){if(F.cancelled)throw x(),new Error("cancelled");q.diffs=e,q.pendingRevs=0})}function v(){if(!F.cancelled&&!q){if(0===A.length)return void m(!0);q=A.shift(),g().then(p).then(l).then(h).then(v)["catch"](function(e){y("batch processing terminated with error",e)})}}function m(e){return 0===O.changes.length?void(0!==A.length||q||((R&&z.live||L)&&r.emit("uptodate",u.clone(a)),L&&x())):void((e||L||O.changes.length>=I)&&(A.push(O),O={seq:0,changes:[],docs:[]},v()))}function y(e,t){j||(a.ok=!1,a.status="aborting",a.errors.push(t),A=[],O={seq:0,changes:[],docs:[]},x())}function x(){if(!(j||F.cancelled&&(a.status="cancelled",T))){a.status=a.status||"complete",a.end_time=new Date,a.last_seq=C,j=F.cancelled=!0;var l=a.errors.filter(function(e){return"unauthorized"!==e.name&&"forbidden"!==e.name});if(l.length>0){var s=a.errors.pop();a.errors.length>0&&(s.other_errors=a.errors),s.result=a,i(e,t,n,o,r,a,s)}else r.emit("complete",a),r.removeAllListeners()}}function w(e){return F.cancelled?x():(0!==O.changes.length||0!==A.length||q||r.emit("outofdate",u.clone(a)),O.seq=e.seq,O.changes.push(e),void m(0===A.length))}function _(e){return N=!1,F.cancelled?x():(z.since<e.last_seq?(z.since=e.last_seq,E()):R?(z.live=!0,E()):L=!0,void m(!0))}function k(e){return N=!1,F.cancelled?x():void y("changes rejected",e)}function E(){function e(){o.cancel()}function n(){r.removeListener("cancel",e)}if(!N&&!L&&A.length<D){N=!0,r.once("cancel",e);var o=t.changes(z).on("change",w);o.then(n,n),o.then(_)["catch"](k)}}function S(){B.getCheckpoint().then(function(e){C=e,z={since:C,limit:I,batch_size:I,style:"all_docs",doc_ids:U,returnDocs:!1},o.filter&&(z.filter=o.filter),o.query_params&&(z.query_params=o.query_params),E()})["catch"](function(e){y("getCheckpoint rejected with ",e)})}var q,A=[],O={seq:0,changes:[],docs:[]},T=!1,L=!1,j=!1,C=0,R=o.continuous||o.live||!1,I=o.batch_size||100,D=o.batches_limit||10,N=!1,U=o.doc_ids,F={cancelled:!1},B=new f(t,n,e,F);a=a||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var z={};r.ready(t,n),r.once("cancel",x),"function"==typeof o.onChange&&r.on("change",o.onChange),"function"==typeof o.complete&&(r.once("error",o.complete),r.once("complete",function(e){o.complete(null,e)})),"undefined"==typeof o.since?S():(T=!0,B.writeCheckpoint(o.since).then(function(){return T=!1,F.cancelled?void x():(C=o.since,void S())})["catch"](function(e){throw T=!1,y("writeCheckpoint completed with error",e),e}))}function c(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e):e.then?e:u.Promise.resolve(e)}function d(e,t,n,o){"function"==typeof n&&(o=n,n={}),"undefined"==typeof n&&(n={}),n.complete||(n.complete=o||function(){}),n=u.clone(n),n.continuous=n.continuous||n.live,n.retry=n.retry||!1,n.PouchConstructor=n.PouchConstructor||this;var r=new a(n);return c(e,n).then(function(e){return c(t,n).then(function(t){return l(e,t,n).then(function(o){s(o,e,t,n,r)})})})["catch"](function(e){r.emit("error",e),n.complete(e)}),r}var u=e("./utils"),p=e("events").EventEmitter,f=e("./checkpointer"),b=50;u.inherits(a,p),a.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},a.prototype.ready=function(e,t){function n(){r.cancel()}function o(){e.removeListener("destroyed",n),t.removeListener("destroyed",n)}var r=this;this.once("change",function(){"pending"===this.state?(r.state="active",r.emit("syncStarted")):"stopped"===r.state&&(r.state="active",r.emit("syncRestarted"))}),e.once("destroyed",n),t.once("destroyed",n),this.then(o,o)},n.toPouch=c,n.replicate=d},{"./checkpointer":7,"./utils":26,events:30}],23:[function(e,t){(function(n){"use strict";var o=e("./constructor"),r=e("./utils"),i=r.Promise,a=e("events").EventEmitter;o.adapters={},o.preferredAdapters=e("./adapters/preferredAdapters.js"),o.prefix="_pouch_";var l=new a,s=["on","addListener","emit","listeners","once","removeAllListeners","removeListener","setMaxListeners"];s.forEach(function(e){o[e]=l[e].bind(l)}),o.setMaxListeners(0),o.parseAdapter=function(e,t){var i,a,l=e.match(/([a-z\-]*):\/\/(.*)/);if(l){if(e=/http(s?)/.test(l[1])?l[1]+"://"+l[2]:l[2],i=l[1],!o.adapters[i].valid())throw"Invalid adapter";return{name:e,adapter:l[1]}}var s="idb"in o.adapters&&"websql"in o.adapters&&r.hasLocalStorage()&&n.localStorage["_pouch__websqldb_"+o.prefix+e];if("undefined"!=typeof t&&t.db)a="leveldb";else for(var c=0;c<o.preferredAdapters.length;++c)if(a=o.preferredAdapters[c],a in o.adapters){if(s&&"idb"===a)continue;break}if(i=o.adapters[a],a&&i){var d="use_prefix"in i?i.use_prefix:!0;return{name:d?o.prefix+e:e,adapter:a}}throw"No valid adapter found"},o.destroy=r.toPromise(function(e,t,n){function a(){c.destroy(p,t,function(t,r){t?n(t):(o.emit("destroyed",e),o.emit(e,"destroyed"),n(null,r||{ok:!0}))})}("function"==typeof t||"undefined"==typeof t)&&(n=t,t={}),e&&"object"==typeof e&&(t=e,e=void 0);var l=o.parseAdapter(t.name||e,t),s=l.name,c=o.adapters[l.adapter],d="use_prefix"in c?c.use_prefix:!0,u=d?s.replace(new RegExp("^"+o.prefix),""):s,p=("http"===l.adapter||"https"===l.adapter?"":t.prefix||"")+s,f=r.extend(!0,{},t,{adapter:l.adapter});new o(u,f,function(e,s){return e?n(e):void s.get("_local/_pouch_dependentDbs",function(e,s){if(e)return 404!==e.status?n(e):a();var c=s.dependentDbs,u=Object.keys(c).map(function(e){var n=d?e.replace(new RegExp("^"+o.prefix),""):e,i=r.extend(!0,t,{adapter:l.adapter});return o.destroy(n,i)});i.all(u).then(a,function(e){n(e)})})})}),o.allDbs=r.toPromise(function(e){var t=new Error("allDbs method removed");t.stats="400",e(t)}),o.adapter=function(e,t){t.valid()&&(o.adapters[e]=t)},o.plugin=function(e){Object.keys(e).forEach(function(t){o.prototype[t]=e[t]})},o.defaults=function(e){function t(t,n,i){("function"==typeof n||"undefined"==typeof n)&&(i=n,n={}),t&&"object"==typeof t&&(n=t,t=void 0),n=r.extend(!0,{},e,n),o.call(this,t,n,i)}return r.inherits(t,o),t.destroy=r.toPromise(function(t,n,i){return("function"==typeof n||"undefined"==typeof n)&&(i=n,n={}),t&&"object"==typeof t&&(n=t,t=void 0),n=r.extend(!0,{},e,n),o.destroy(t,n,i)}),s.forEach(function(e){t[e]=l[e].bind(l)}),t.setMaxListeners(0),t.preferredAdapters=o.preferredAdapters.slice(),Object.keys(o).forEach(function(e){e in t||(t[e]=o[e])}),t},t.exports=o}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapters/preferredAdapters.js":4,"./constructor":8,"./utils":26,events:30}],24:[function(e,t){"use strict";function n(e,t,n,a){return"function"==typeof n&&(a=n,n={}),"undefined"==typeof n&&(n={}),n=r.clone(n),n.PouchConstructor=n.PouchConstructor||this,e=i.toPouch(e,n),t=i.toPouch(t,n),new o(e,t,n,a)}function o(e,t,n,o){function i(e){f||(f=!0,d.emit("cancel",e))}function l(e){d.emit("change",{direction:"pull",change:e})}function s(e){d.emit("change",{direction:"push",change:e})}function c(e){return function(t,n){var o="change"===t&&(n===l||n===s),r="cancel"===t&&n===i,a=t in b&&n===b[t];(o||r||a)&&(t in h||(h[t]={}),h[t][e]=!0,2===Object.keys(h[t]).length&&d.removeAllListeners(t))}}var d=this;this.canceled=!1;var u,p;"onChange"in n&&(u=n.onChange,delete n.onChange),"function"!=typeof o||n.complete?"complete"in n&&(p=n.complete,delete n.complete):p=o,this.push=a(e,t,n),this.pull=a(t,e,n);var f=!1,b={},h={};this.on("newListener",function(e){"change"===e?(d.pull.on("change",l),d.push.on("change",s)):"cancel"===e?(d.pull.on("cancel",i),d.push.on("cancel",i)):"error"===e||"removeListener"===e||"complete"===e||e in b||(b[e]=function(t){d.emit(e,t)},d.pull.on(e,b[e]),d.push.on(e,b[e]))}),this.on("removeListener",function(e){"change"===e?(d.pull.removeListener("change",l),d.push.removeListener("change",s)):"cancel"===e?(d.pull.removeListener("cancel",i),d.push.removeListener("cancel",i)):e in b&&"function"==typeof b[e]&&(d.pull.removeListener(e,b[e]),d.push.removeListener(e,b[e]),delete b[e])}),this.pull.on("removeListener",c("pull")),this.push.on("removeListener",c("push"));var g=r.Promise.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return d.emit("complete",t),p&&p(null,t),d.removeAllListeners(),t},function(e){throw d.cancel(),d.emit("error",e),p&&p(e),d.removeAllListeners(),e});this.then=function(e,t){return g.then(e,t)},this["catch"]=function(e){return g["catch"](e)}}var r=e("./utils"),i=e("./replicate"),a=i.replicate,l=e("events").EventEmitter;r.inherits(o,l),t.exports=n,o.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())}},{"./replicate":22,"./utils":26,events:30}],25:[function(e,t){"use strict";function n(){this.isReady=!1,this.failed=!1,this.queue=[]}t.exports=n,n.prototype.execute=function(){var e,t;if(this.failed)for(;e=this.queue.shift();)"function"!=typeof e?(t=e.parameters[e.parameters.length-1],"function"==typeof t?t(this.failed):"changes"===e.name&&"function"==typeof t.complete&&t.complete(this.failed)):e(this.failed);else if(this.isReady)for(;e=this.queue.shift();)"function"==typeof e?e():e.task=this.db[e.name].apply(this.db,e.parameters)},n.prototype.fail=function(e){this.failed=e,this.execute()},n.prototype.ready=function(e){return this.failed?!1:0===arguments.length?this.isReady:(this.isReady=e?!0:!1,this.db=e,void this.execute())},n.prototype.addTask=function(e,t){if("function"!=typeof e){var n={name:e,parameters:t};return this.queue.push(n),this.failed&&this.execute(),n}this.queue.push(e),this.failed&&this.execute()}},{}],26:[function(e,t,n){(function(t,o){function r(e){var t={};return e.forEach(function(e){t[e]=!0}),t}function i(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function a(){if(!(this instanceof a))return new a;var e=this;d.call(this),this.isChrome=i(),this.listeners={},this.hasLocal=!1,this.isChrome||(this.hasLocal=n.hasLocalStorage()),this.isChrome?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):this.hasLocal&&(o.addEventListener?o.addEventListener("storage",function(t){e.emit(t.key)}):o.attachEvent("storage",function(t){e.emit(t.key)}))}var l=e("./merge");n.extend=e("pouchdb-extend"),n.ajax=e("./deps/ajax"),n.createBlob=e("./deps/blob"),n.uuid=e("./deps/uuid"),n.getArguments=e("argsarray");var s=e("./deps/buffer"),c=e("./deps/errors"),d=e("events").EventEmitter,u=e("./deps/collections");n.Map=u.Map,n.Set=u.Set,n.Promise="function"==typeof o.Promise?o.Promise:e("bluebird");var p=n.Promise,f=r(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),b=r(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]);n.lastIndexOf=function(e,t){for(var n=e.length-1;n>=0;n--)if(e.charAt(n)===t)return n;return-1},n.clone=function(e){return n.extend(!0,{},e)},n.inherits=e("inherits"),n.invalidIdError=function(e){var t;if(e?"string"!=typeof e?(t=new TypeError(c.INVALID_ID.message),t.status=400):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=new TypeError(c.RESERVED_ID.message),t.status=400):(t=new TypeError(c.MISSING_ID.message),t.status=412),t)throw t},n.call=n.getArguments(function(e){if(e.length){var t=e.shift();"function"==typeof t&&t.apply(this,e)}}),n.isLocalId=function(e){return/^_local/.test(e)},n.isDeleted=function(e,t){t||(t=l.winningRev(e));var n=t.indexOf("-");-1!==n&&(t=t.substring(n+1));var o=!1;return l.traverseRevTree(e.rev_tree,function(e,n,r,i,a){r===t&&(o=!!a.deleted)}),o},n.revExists=function(e,t){var n=!1;return l.traverseRevTree(e.rev_tree,function(e,o,r){o+"-"+r===t&&(n=!0)}),n},n.filterChange=function(e){return function(t){var n={},o=e.filter&&"function"==typeof e.filter;if(n.query=e.query_params,e.filter&&o&&!e.filter.call(this,t.doc,n))return!1;if(e.doc_ids&&-1===e.doc_ids.indexOf(t.id))return!1;if(e.include_docs)for(var r in t.doc._attachments)t.doc._attachments.hasOwnProperty(r)&&(t.doc._attachments[r].stub=!0);else delete t.doc;return!0}},n.parseDoc=function(e,t){var o,r,i,a,l={status:"available"};if(e._deleted&&(l.deleted=!0),t)if(e._id||(e._id=n.uuid()),r=n.uuid(32,16).toLowerCase(),e._rev){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i){var s=new TypeError("invalid value for property '_rev'");s.status=400}e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],{status:"missing"},[[r,l,[]]]]}],o=parseInt(i[1],10)+1}else e._rev_tree=[{pos:1,ids:[r,l,[]]}],o=1;else if(e._revisions&&(e._rev_tree=[{pos:e._revisions.start-e._revisions.ids.length+1,ids:e._revisions.ids.reduce(function(e,t){return null===e?[t,l,[]]:[t,{status:"missing"},[e]]},null)}],o=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if(i=/^(\d+)-(.+)$/.exec(e._rev),!i)throw a=new TypeError(c.BAD_ARG.message),a.status=c.BAD_ARG.status,a;o=parseInt(i[1],10),r=i[2],e._rev_tree=[{pos:parseInt(i[1],10),ids:[i[2],l,[]]}]}n.invalidIdError(e._id),e._rev=[o,r].join("-");var d={metadata:{},data:{}};for(var u in e)if(e.hasOwnProperty(u)){var p="_"===u[0];if(p&&!f[u])throw a=new Error(c.DOC_VALIDATION.message+": "+u),a.status=c.DOC_VALIDATION.status,a;p&&!b[u]?d.metadata[u.slice(1)]=e[u]:d.data[u]=e[u]}return d},n.isCordova=function(){return"undefined"!=typeof cordova||"undefined"!=typeof PhoneGap||"undefined"!=typeof phonegap},n.hasLocalStorage=function(){if(i())return!1;try{return o.localStorage}catch(e){return!1}},n.Changes=a,n.inherits(a,d),a.prototype.addListener=function(e,t,o,r){function i(){o.changes({include_docs:r.include_docs,conflicts:r.conflicts,continuous:!1,descending:!1,filter:r.filter,view:r.view,since:r.since,query_params:r.query_params,onChange:function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,n.call(r.onChange,e))}})}this.listeners[t]||(this.listeners[t]=i,this.on(e,i))},a.prototype.removeListener=function(e,t){t in this.listeners&&d.prototype.removeListener.call(this,e,this.listeners[t])},a.prototype.notifyLocalWindows=function(e){this.isChrome?chrome.storage.local.set({dbName:e}):this.hasLocal&&(localStorage[e]="a"===localStorage[e]?"b":"a")},a.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)},n.atob=t.browser&&"atob"in o?function(e){return atob(e)}:function(e){var t=new s(e,"base64");if(t.toString("base64")!==e)throw"Cannot base64 encode full string";return t.toString("binary")},n.btoa=t.browser&&"btoa"in o?function(e){return btoa(e)}:function(e){return new s(e,"binary").toString("base64")},n.fixBinary=function(e){if(!t.browser)return e;for(var n=e.length,o=new ArrayBuffer(n),r=new Uint8Array(o),i=0;n>i;i++)r[i]=e.charCodeAt(i);return o},n.readAsBinaryString=function(e,t){var o=new FileReader,r="function"==typeof o.readAsBinaryString;o.onloadend=function(e){var o=e.target.result||"";return r?t(o):void t(n.arrayBufferToBinaryString(o))},r?o.readAsBinaryString(e):o.readAsArrayBuffer(e)},n.once=function(e){var t=!1;return n.getArguments(function(n){if(t)throw new Error("once called  more than once");t=!0,e.apply(this,n)})},n.toPromise=function(e){return n.getArguments(function(o){var r,i=this,a="function"==typeof o[o.length-1]?o.pop():!1;a&&(r=function(e,n){t.nextTick(function(){a(e,n)})});var l=new p(function(t,r){var a;try{var l=n.once(function(e,n){e?r(e):t(n)});o.push(l),a=e.apply(i,o),a&&"function"==typeof a.then&&t(a)}catch(s){r(s)}});return r&&l.then(function(e){r(null,e)},r),l.cancel=function(){return this},l})},n.adapterFun=function(e,t){return n.toPromise(n.getArguments(function(o){if(this._closed)return p.reject(new Error("database is closed"));var r=this;return this.taskqueue.isReady?t.apply(this,o):new n.Promise(function(t,n){r.taskqueue.addTask(function(i){i?n(i):t(r[e].apply(r,o))})})}))},n.arrayBufferToBinaryString=function(e){for(var t="",n=new Uint8Array(e),o=n.byteLength,r=0;o>r;r++)t+=String.fromCharCode(n[r]);return t},n.cancellableFun=function(e,t,o){o=o?n.clone(!0,{},o):{};var r=new d,i=o.complete||function(){},a=o.complete=n.once(function(e,t){e?i(e):(r.emit("end",t),i(null,t)),r.removeAllListeners()}),l=o.onChange||function(){},s=0;t.on("destroyed",function(){r.removeAllListeners()}),o.onChange=function(e){l(e),e.seq<=s||(s=e.seq,r.emit("change",e),e.deleted?r.emit("delete",e):1===e.changes.length&&"1-"===e.changes[0].rev.slice(0,1)?r.emit("create",e):r.emit("update",e))};var c=new p(function(e,t){o.complete=function(n,o){n?t(n):e(o)}});return c.then(function(e){a(null,e)},a),c.cancel=function(){c.isCancelled=!0,t.taskqueue.isReady&&o.complete(null,{status:"cancelled"})},t.taskqueue.isReady?e(t,o,c):t.taskqueue.addTask(function(){c.isCancelled?o.complete(null,{status:"cancelled"}):e(t,o,c)}),c.on=r.on.bind(r),c.once=r.once.bind(r),c.addListener=r.addListener.bind(r),c.removeListener=r.removeListener.bind(r),c.removeAllListeners=r.removeAllListeners.bind(r),c.setMaxListeners=r.setMaxListeners.bind(r),c.listeners=r.listeners.bind(r),c.emit=r.emit.bind(r),c},n.MD5=n.toPromise(e("./deps/md5")),n.explain404=function(e){t.browser&&"console"in o&&"info"in console&&console.info("The above 404 is totally normal. "+e+"\nâ¥ the PouchDB team")},n.parseUri=e("./deps/parse-uri"),n.compare=function(e,t){return t>e?-1:e>t?1:0}}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./deps/ajax":9,"./deps/blob":10,"./deps/buffer":29,"./deps/collections":11,"./deps/errors":12,"./deps/md5":13,"./deps/parse-uri":15,"./deps/uuid":17,"./merge":21,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31,argsarray:28,bluebird:36,events:30,inherits:32,"pouchdb-extend":51}],27:[function(e,t){t.exports="3.1.0"},{}],28:[function(e,t){"use strict";function n(e){return function(){var t=arguments.length;if(t){for(var n=[],o=-1;++o<t;)n[o]=arguments[o];return e.call(this,n)}return e.call(this,[])}}t.exports=n},{}],29:[function(){},{}],30:[function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function r(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!r(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,r,l,s,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(o(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,l=new Array(r-1),s=1;r>s;s++)l[s-1]=arguments[s];n.apply(this,l)}else if(i(n)){for(r=arguments.length,l=new Array(r-1),s=1;r>s;s++)l[s-1]=arguments[s];for(c=n.slice(),r=c.length,s=0;r>s;s++)c[s].apply(this,l)}return!0},n.prototype.addListener=function(e,t){var r;if(!o(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned){var r;r=a(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},n.prototype.removeListener=function(e,t){var n,r,a,l;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],a=n.length,r=-1,n===t||o(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(n)){for(l=a;l-->0;)if(n[l]===t||n[l].listener&&n[l].listener===t){r=l;break}if(0>r)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],o(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?o(e._events[t])?1:e._events[t].length:0}},{}],31:[function(e,t){var n=t.exports={};n.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var o=n.shift();o()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),n.title="browser",n.browser=!0,n.env={},n.argv=[],n.binding=function(){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(){throw new Error("process.chdir is not supported")}},{}],32:[function(e,t){t.exports="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],33:[function(e,t){"use strict";function n(){}t.exports=n},{}],34:[function(e,t){"use strict";function n(e){function t(e,t){function o(e){c[t]=e,++d===n&!s&&(s=!0,l.resolve(p,c))}i(e).then(o,function(e){s||(s=!0,l.reject(p,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return r(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return i([]);for(var c=new Array(n),d=0,u=-1,p=new o(a);++u<n;)t(e[u],u);return p}var o=e("./promise"),r=e("./reject"),i=e("./resolve"),a=e("./INTERNAL"),l=e("./handlers");t.exports=n},{"./INTERNAL":33,"./handlers":35,"./promise":37,"./reject":40,"./resolve":41}],35:[function(e,t,n){"use strict";function o(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var r=e("./tryCatch"),i=e("./resolveThenable"),a=e("./states");n.resolve=function(e,t){var l=r(o,t);if("error"===l.status)return n.reject(e,l.value);var s=l.value;if(s)i.safely(e,s);else{e.state=a.FULFILLED,e.outcome=t;for(var c=-1,d=e.queue.length;++c<d;)e.queue[c].callFulfilled(t)}return e},n.reject=function(e,t){e.state=a.REJECTED,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callRejected(t);return e}},{"./resolveThenable":42,"./states":43,"./tryCatch":44}],36:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all"),n.race=e("./race")},{"./all":34,"./promise":37,"./race":39,"./reject":40,"./resolve":41}],37:[function(e,t){"use strict";
function n(e){if(!(this instanceof n))return new n(e);if("function"!=typeof e)throw new TypeError("reslover must be a function");this.state=a.PENDING,this.queue=[],this.outcome=void 0,e!==r&&i.safely(this,e)}var o=e("./unwrap"),r=e("./INTERNAL"),i=e("./resolveThenable"),a=e("./states"),l=e("./queueItem");t.exports=n,n.prototype["catch"]=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a.FULFILLED||"function"!=typeof t&&this.state===a.REJECTED)return this;var i=new n(r);if(this.state!==a.PENDING){var s=this.state===a.FULFILLED?e:t;o(i,s,this.outcome)}else this.queue.push(new l(i,e,t));return i}},{"./INTERNAL":33,"./queueItem":38,"./resolveThenable":42,"./states":43,"./unwrap":45}],38:[function(e,t){"use strict";function n(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var o=e("./handlers"),r=e("./unwrap");t.exports=n,n.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},n.prototype.otherCallFulfilled=function(e){r(this.promise,this.onFulfilled,e)},n.prototype.callRejected=function(e){o.reject(this.promise,e)},n.prototype.otherCallRejected=function(e){r(this.promise,this.onRejected,e)}},{"./handlers":35,"./unwrap":45}],39:[function(e,t){"use strict";function n(e){function t(e){i(e).then(function(e){s||(s=!0,l.resolve(d,e))},function(e){s||(s=!0,l.reject(d,e))})}if("[object Array]"!==Object.prototype.toString.call(e))return r(new TypeError("must be an array"));var n=e.length,s=!1;if(!n)return i([]);for(var c=-1,d=new o(a);++c<n;)t(e[c]);return d}var o=e("./promise"),r=e("./reject"),i=e("./resolve"),a=e("./INTERNAL"),l=e("./handlers");t.exports=n},{"./INTERNAL":33,"./handlers":35,"./promise":37,"./reject":40,"./resolve":41}],40:[function(e,t){"use strict";function n(e){var t=new o(r);return i.reject(t,e)}var o=e("./promise"),r=e("./INTERNAL"),i=e("./handlers");t.exports=n},{"./INTERNAL":33,"./handlers":35,"./promise":37}],41:[function(e,t){"use strict";function n(e){if(e)return e instanceof o?e:i.resolve(new o(r),e);var t=typeof e;switch(t){case"boolean":return a;case"undefined":return s;case"object":return l;case"number":return c;case"string":return d}}var o=e("./promise"),r=e("./INTERNAL"),i=e("./handlers");t.exports=n;var a=i.resolve(new o(r),!1),l=i.resolve(new o(r),null),s=i.resolve(new o(r),void 0),c=i.resolve(new o(r),0),d=i.resolve(new o(r),"")},{"./INTERNAL":33,"./handlers":35,"./promise":37}],42:[function(e,t,n){"use strict";function o(e,t){function n(t){l||(l=!0,r.reject(e,t))}function o(t){l||(l=!0,r.resolve(e,t))}function a(){t(o,n)}var l=!1,s=i(a);"error"===s.status&&n(s.value)}var r=e("./handlers"),i=e("./tryCatch");n.safely=o},{"./handlers":35,"./tryCatch":44}],43:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],44:[function(e,t){"use strict";function n(e,t){var n={};try{n.value=e(t),n.status="success"}catch(o){n.status="error",n.value=o}return n}t.exports=n},{}],45:[function(e,t){"use strict";function n(e,t,n){o(function(){var o;try{o=t(n)}catch(i){return r.reject(e,i)}o===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,o)})}var o=e("immediate"),r=e("./handlers");t.exports=n},{"./handlers":35,immediate:46}],46:[function(e,t){"use strict";function n(){r=!0;for(var e,t,n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}function o(e){1!==l.push(e)||r||i()}for(var r,i,a=[e("./nextTick"),e("./mutation.js"),e("./messageChannel"),e("./stateChange"),e("./timeout")],l=[],s=-1,c=a.length;++s<c;)if(a[s]&&a[s].test&&a[s].test()){i=a[s].install(n);break}t.exports=o},{"./messageChannel":47,"./mutation.js":48,"./nextTick":29,"./stateChange":49,"./timeout":50}],47:[function(e,t,n){(function(e){"use strict";n.test=function(){return e.setImmediate?!1:"undefined"!=typeof e.MessageChannel},n.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],48:[function(e,t,n){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;n.test=function(){return t},n.install=function(n){var o=0,r=new t(n),i=e.document.createTextNode("");return r.observe(i,{characterData:!0}),function(){i.data=o=++o%2}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(e,t,n){(function(e){"use strict";n.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},n.install=function(t){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),t}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],50:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}],51:[function(e,t){"use strict";function n(e){return null===e?String(e):"object"==typeof e||"function"==typeof e?s[p.call(e)]||"object":typeof e}function o(e){return null!==e&&e===e.window}function r(e){if(!e||"object"!==n(e)||e.nodeType||o(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var r;for(r in e);return void 0===r||f.call(e,r)}function i(e){return"function"===n(e)}function a(){for(var e=[],t=-1,n=arguments.length,o=new Array(n);++t<n;)o[t]=arguments[t];var r={};e.push({args:o,result:{container:r,key:"key"}});for(var i;i=e.pop();)l(e,i.args,i.result);return r.key}function l(e,t,n){var o,a,l,s,c,d,u,p=t[0]||{},f=1,h=t.length,g=!1,v=/\d+/;for("boolean"==typeof p&&(g=p,p=t[1]||{},f=2),"object"==typeof p||i(p)||(p={}),h===f&&(p=this,--f);h>f;f++)if(null!=(o=t[f])){u=b(o);for(a in o)if(!(a in Object.prototype)){if(u&&!v.test(a))continue;if(l=p[a],s=o[a],p===s)continue;g&&s&&(r(s)||(c=b(s)))?(c?(c=!1,d=l&&b(l)?l:[]):d=l&&r(l)?l:{},e.push({args:[g,d,s],result:{container:p,key:a}})):void 0!==s&&(b(o)&&i(s)||(p[a]=s))}}n.container[n.key]=p}for(var s={},c=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],d=0;d<c.length;d++){var u=c[d];s["[object "+u+"]"]=u.toLowerCase()}var p=s.toString,f=s.hasOwnProperty,b=Array.isArray||function(e){return"array"===n(e)};t.exports=a},{}],52:[function(e,t){"use strict";var n=e("./upsert"),o=e("./utils"),r=o.Promise;t.exports=function(e){var t=e.db,i=e.viewName,a=e.map,l=e.reduce,s=e.temporary,c=a.toString()+(l&&l.toString())+"undefined";if(!s&&t._cachedViews){var d=t._cachedViews[c];if(d)return r.resolve(d)}return t.info().then(function(e){function r(e){e.views=e.views||{};var t=i;-1===t.indexOf("/")&&(t=i+"/"+i);var n=e.views[t]=e.views[t]||{};return n[d]?void 0:(n[d]=!0,e)}var d=e.db_name+"-mrview-"+(s?"temp":o.MD5(c));return n(t,"_local/mrviews",r).then(function(){return t.registerDependentDatabase(d).then(function(e){var n=e.db;n.auto_compaction=!0;var o={name:d,db:n,sourceDB:t,adapter:t.adapter,mapFun:a,reduceFun:l};return o.db.get("_local/lastSeq")["catch"](function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,s||(t._cachedViews=t._cachedViews||{},t._cachedViews[c]=o,o.db.on("destroyed",function(){delete t._cachedViews[c]})),o})})})})}},{"./upsert":58,"./utils":59}],53:[function(_dereq_,module,exports){"use strict";module.exports=function(func,emit,sum,log,isArray,toJSON){return eval("'use strict'; ("+func.replace(/;\s*$/,"")+");")}},{}],54:[function(e,t,n){(function(t){"use strict";function o(e){return-1===e.indexOf("/")?[e,e]:e.split("/")}function r(e,t,n){try{return{output:t.apply(null,n)}}catch(o){return e.emit("error",o),{error:o}}}function i(e,t){var n=k(e.key,t.key);return 0!==n?n:k(e.value,t.value)}function a(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}function l(e){var t=new Error("builtin "+e+" function requires map values to be numbers or number arrays");return t.name="invalid_value",t.status=500,t}function s(e){for(var t=0,n=0,o=e.length;o>n;n++){var r=e[n];if("number"!=typeof r){if(!Array.isArray(r))throw l("_sum");t="number"==typeof t?[t]:t;for(var i=0,a=r.length;a>i;i++){var s=r[i];if("number"!=typeof s)throw l("_sum");"undefined"==typeof t[i]?t.push(s):t[i]+=s}}else"number"==typeof t?t+=r:t[0]+=r}return t}function c(e,t,n,o){var r=t[e];"undefined"!=typeof r&&(o&&(r=encodeURIComponent(JSON.stringify(r))),n.push(e+"="+r))}function d(e,t){var n=e.descending?"endkey":"startkey",o=e.descending?"startkey":"endkey";if("undefined"!=typeof e[n]&&"undefined"!=typeof e[o]&&k(e[n],e[o])>0)throw new m("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&e.reduce!==!1){if(e.include_docs)throw new m("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new m("Multi-key fetches for reduce views must use {group: true}")}if(e.group_level){if("number"!=typeof e.group_level)throw new m('Invalid value for integer: "'+e.group_level+'"');if(e.group_level<0)throw new m('Invalid value for positive integer: "'+e.group_level+'"')}}function u(e,t,n){var r,i=[],a="GET";if(c("reduce",n,i),c("include_docs",n,i),c("limit",n,i),c("descending",n,i),c("group",n,i),c("group_level",n,i),c("skip",n,i),c("stale",n,i),c("conflicts",n,i),c("startkey",n,i,!0),c("endkey",n,i,!0),c("inclusive_end",n,i),c("key",n,i,!0),i=i.join("&"),i=""===i?"":"?"+i,"undefined"!=typeof n.keys){var l=2e3,s="keys="+encodeURIComponent(JSON.stringify(n.keys));s.length+i.length+1<=l?i+=("?"===i[0]?"&":"?")+s:(a="POST","string"==typeof t?r=JSON.stringify({keys:n.keys}):t.keys=n.keys)}if("string"==typeof t){var d=o(t);return e.request({method:a,url:"_design/"+d[0]+"/_view/"+d[1]+i,body:r})}return r=r||{},Object.keys(t).forEach(function(e){r[e]=Array.isArray(t[e])?t[e]:t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:r})}function p(e){return function(t){if(404===t.status)return e;throw t}}function f(e,t,n){var o="_local/doc_"+e;return t.db.get(o)["catch"](p({_id:o,keys:[]})).then(function(o){return T.resolve().then(function(){return o.keys.length?t.db.allDocs({keys:o.keys,include_docs:!0}):{rows:[]}}).then(function(t){var r=t.rows.map(function(e){return e.doc}).filter(function(e){return e}),i=n[e],a={};r.forEach(function(e){if(a[e._id]=!0,e._deleted=!i[e._id],!e._deleted){var t=i[e._id];"value"in t&&(e.value=t.value)}});var l=Object.keys(i);return l.forEach(function(e){if(!a[e]){var t={_id:e},n=i[e];"value"in n&&(t.value=n.value),r.push(t)}}),o.keys=O.uniq(l.concat(o.keys)),r.splice(0,0,o),r})})}function b(e,t,n){var o="_local/lastSeq";return e.db.get(o)["catch"](p({_id:o,seq:0})).then(function(o){var r=Object.keys(t);return T.all(r.map(function(n){return f(n,e,t)})).then(function(t){var r=[];return t.forEach(function(e){r=r.concat(e)}),o.seq=n,r.push(o),e.db.bulkDocs({docs:r})})})}function h(e,t,n){0===n.group_level&&delete n.group_level;var o,i=n.group||n.group_level;o=R[e.reduceFun]?R[e.reduceFun]:A(e.reduceFun.toString(),null,s,x,Array.isArray,JSON.parse);var l=[],c=n.group_level;t.forEach(function(e){var t=l[l.length-1],n=i?e.key:null;return i&&Array.isArray(n)&&"number"==typeof c&&(n=n.length>c?n.slice(0,c):n),t&&0===k(t.key[0][0],n)?(t.key.push([n,e.id]),void t.value.push(e.value)):void l.push({key:[[n,e.id]],value:[e.value]})});for(var d=0,u=l.length;u>d;d++){var p=l[d],f=r(e.sourceDB,o,[p.key,p.value,!1]);p.value=f.error?null:f.output,p.key=p.key[0][0]}return{rows:a(l,n.limit,n.skip)}}function g(e){return e.request({method:"POST",url:"_view_cleanup"})}function v(e,n,r){if("http"===e.type())return u(e,n,r);if("string"!=typeof n){d(r,n);var i={db:e,viewName:"temp_view/temp_view",map:n.map,reduce:n.reduce,temporary:!0};return j.add(function(){return q(i).then(function(e){function t(){return e.db.destroy()}return O.fin(I(e).then(function(){return D(e,r)}),t)})}),j.finish()}var a=n,l=o(a),s=l[0],c=l[1];return e.get("_design/"+s).then(function(n){var o=n.views&&n.views[c];if(!o||"string"!=typeof o.map)throw new y("ddoc "+s+" has no view named "+c);d(r,o);var i={db:e,viewName:a,map:o.map,reduce:o.reduce};return q(i).then(function(e){return"ok"===r.stale||"update_after"===r.stale?("update_after"===r.stale&&t.nextTick(function(){I(e)}),D(e,r)):I(e).then(function(){return D(e,r)})})})}function m(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,m)}catch(t){}}function y(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,y)}catch(t){}}var x,w=e("pouchdb-collate"),_=e("./taskqueue"),k=w.collate,E=w.toIndexableString,S=w.normalizeKey,q=e("./create-view"),A=e("./evalfunc");x="undefined"!=typeof console&&"function"==typeof console.log?Function.prototype.bind.call(console.log,console):function(){};var O=e("./utils"),T=O.Promise,L=new _,j=new _,C=50,R={_sum:function(e,t){return s(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(e){for(var t=0,n=0,o=e.length;o>n;n++){var r=e[n];t+=r*r}return t}return{sum:s(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}},I=O.sequentialize(L,function(e){function t(e,t){var n={id:a._id,key:S(e)};"undefined"!=typeof t&&null!==t&&(n.value=S(t)),o.push(n)}function n(t,n){return function(){return b(e,t,n)}}var o,a,l;if("function"==typeof e.mapFun&&2===e.mapFun.length){var c=e.mapFun;l=function(e){return c(e,t)}}else l=A(e.mapFun.toString(),t,s,x,Array.isArray,JSON.parse);var d=e.seq||0,u=new _;return new T(function(t,s){function c(){u.finish().then(function(){e.seq=d,t()})}function p(){function t(e){s(e)}e.sourceDB.changes({conflicts:!0,include_docs:!0,since:d,limit:C}).on("complete",function(t){var s=t.results;if(!s.length)return c();for(var f={},b=0,h=s.length;h>b;b++){var g=s[b];if("_"!==g.doc._id[0]){o=[],a=g.doc,a._deleted||r(e.sourceDB,l,[a]),o.sort(i);for(var v,m={},y=0,x=o.length;x>y;y++){var w=o[y],_=[w.key,w.id];w.key===v&&_.push(y);var k=E(_);m[k]=w,v=w.key}f[g.doc._id]=m}d=g.seq}return u.add(n(f,d)),s.length<C?c():p()}).on("error",t)}p()})}),D=O.sequentialize(L,function(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return r=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(n>t||t>n))return e.doc.value}var o=w.parseIndexableString(e.doc._id);return{key:o[0],id:o[1],value:"value"in e.doc?e.doc.value:null}})})}function o(n){var o;if(o=i?h(e,n,t):{total_rows:r,offset:a,rows:n},t.include_docs){var l=n.map(function(n){var o=n.value,r=o&&"object"==typeof o&&o._id||n.id;return e.sourceDB.get(r,{conflicts:t.conflicts}).then(function(e){n.doc=e},function(){})});return T.all(l).then(function(){return o})}return o}var r,i=e.reduceFun&&t.reduce!==!1,a=t.skip||0;"undefined"==typeof t.keys||t.keys.length||(t.limit=0,delete t.keys);var l=function(e){return e.reduce(function(e,t){return e.concat(t)})};if("undefined"!=typeof t.keys){var s=t.keys,c=s.map(function(e){var t={startkey:E([e]),endkey:E([e,{}])};return n(t)});return T.all(c).then(l).then(o)}var d={descending:t.descending};if("undefined"!=typeof t.startkey&&(d.startkey=E(t.descending?[t.startkey,{}]:[t.startkey])),"undefined"!=typeof t.endkey){var u=t.inclusive_end!==!1;t.descending&&(u=!u),d.endkey=E(u?[t.endkey,{}]:[t.endkey])}if("undefined"!=typeof t.key){var p=E([t.key]),f=E([t.key,{}]);d.descending?(d.endkey=p,d.startkey=f):(d.startkey=p,d.endkey=f)}return i||("number"==typeof t.limit&&(d.limit=t.limit),d.skip=a),n(d).then(o)}),N=O.sequentialize(L,function(e){return e.get("_local/mrviews").then(function(t){var n={};Object.keys(t.views).forEach(function(e){var t=o(e),r="_design/"+t[0],i=t[1];n[r]=n[r]||{},n[r][i]=!0});var r={keys:Object.keys(n),include_docs:!0};return e.allDocs(r).then(function(o){var r={};o.rows.forEach(function(e){var o=e.key.substring(8);Object.keys(n[e.key]).forEach(function(n){var i=o+"/"+n;t.views[i]||(i=n);var a=Object.keys(t.views[i]),l=e.doc&&e.doc.views&&e.doc.views[n];a.forEach(function(e){r[e]=r[e]||l})})});var i=Object.keys(r).filter(function(e){return!r[e]}),a=i.map(function(t){return e.constructor.destroy(t,{adapter:e.adapter})});return T.all(a).then(function(){return{ok:!0}})})},p({ok:!0}))});n.viewCleanup=O.callbackify(function(){var e=this;return"http"===e.type()?g(e):N(e)}),n.query=function(e,t,n){"function"==typeof t&&(n=t,t={}),t=O.extend(!0,{},t),"function"==typeof e&&(e={map:e});var o=this,r=T.resolve().then(function(){return v(o,e,t)});return O.promisedCallback(r,n),r},O.inherits(m,Error),O.inherits(y,Error)}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"))},{"./create-view":52,"./evalfunc":53,"./taskqueue":57,"./utils":59,"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31,"pouchdb-collate":55}],55:[function(e,t,n){"use strict";function o(e){if(null!==e)switch(typeof e){case"boolean":return e?1:0;case"number":return d(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),o=t?e:Object.keys(e),r=-1,i=o.length,a="";if(t)for(;++r<i;)a+=n.toIndexableString(o[r]);else for(;++r<i;){var l=o[r];a+=n.toIndexableString(l)+n.toIndexableString(e[l])}return a}return""}function r(e,t){var n,o=t,r="1"===e[t];if(r)n=0,t++;else{var i="0"===e[t];t++;var a="",l=e.substring(t,t+p),s=parseInt(l,10)+u;for(i&&(s=-s),t+=p;;){var c=e[t];if("\x00"===c)break;a+=c,t++}a=a.split("."),n=1===a.length?parseInt(a,10):parseFloat(a[0]+"."+a[1]),i&&(n-=10),0!==s&&(n=parseFloat(n+"e"+s))}return{num:n,length:t-o}}function i(e,t){var n=e.pop();if(t.length){var o=t[t.length-1];n===o.element&&(t.pop(),o=t[t.length-1]);var r=o.element,i=o.index;if(Array.isArray(r))r.push(n);else if(i===e.length-2){var a=e.pop();r[a]=n}else e.push(n)}}function a(e,t){for(var o=Math.min(e.length,t.length),r=0;o>r;r++){var i=n.collate(e[r],t[r]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function l(e,t){return e===t?0:e>t?1:-1}function s(e,t){for(var o=Object.keys(e),r=Object.keys(t),i=Math.min(o.length,r.length),a=0;i>a;a++){var l=n.collate(o[a],r[a]);if(0!==l)return l;if(l=n.collate(e[o[a]],t[r[a]]),0!==l)return l}return o.length===r.length?0:o.length>r.length?1:-1}function c(e){var t=["boolean","number","string","object"],n=t.indexOf(typeof e);return~n?null===e?1:Array.isArray(e)?5:3>n?n+2:n+3:Array.isArray(e)?5:void 0}function d(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),o=0>e,r=o?"0":"2",i=(o?-n:n)-u,a=b.padLeft(i.toString(),"0",p);r+=f+a;var l=Math.abs(parseFloat(t[0]));o&&(l=10-l);var s=l.toFixed(20);return s=s.replace(/\.?0+$/,""),r+=f+s}var u=-324,p=3,f="",b=e("./utils");n.collate=function(e,t){if(e===t)return 0;e=n.normalizeKey(e),t=n.normalizeKey(t);var o=c(e),r=c(t);if(o-r!==0)return o-r;if(null===e)return 0;switch(typeof e){case"number":return e-t;case"boolean":return e===t?0:t>e?-1:1;case"string":return l(e,t)}return Array.isArray(e)?a(e,t):s(e,t)},n.normalizeKey=function(e){switch(typeof e){case"undefined":return null;case"number":return 1/0===e||e===-1/0||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var o=e.length;e=new Array(o);for(var r=0;o>r;r++)e[r]=n.normalizeKey(t[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var a=t[i];"undefined"!=typeof a&&(e[i]=n.normalizeKey(a))}}}}return e},n.toIndexableString=function(e){var t="\x00";return e=n.normalizeKey(e),c(e)+f+o(e)+t},n.parseIndexableString=function(e){for(var t=[],n=[],o=0;;){var a=e[o++];if("\x00"!==a)switch(a){case"1":t.push(null);break;case"2":t.push("1"===e[o]),o++;break;case"3":var l=r(e,o);t.push(l.num),o+=l.length;break;case"4":for(var s="";;){var c=e[o];if("\x00"===c)break;s+=c,o++}s=s.replace(/\u0001\u0001/g,"\x00").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(s);break;case"5":var d={element:[],index:t.length};t.push(d.element),n.push(d);break;case"6":var u={element:{},index:t.length};t.push(u.element),n.push(u);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+a)}else{if(1===t.length)return t.pop();i(t,n)}}}},{"./utils":56}],56:[function(e,t,n){"use strict";function o(e,t,n){for(var o="",r=n-e.length;o.length<r;)o+=t;return o}n.padLeft=function(e,t,n){var r=o(e,t,n);return r+e},n.padRight=function(e,t,n){var r=o(e,t,n);return e+r},n.stringLexCompare=function(e,t){var n,o=e.length,r=t.length;for(n=0;o>n;n++){if(n===r)return 1;var i=e.charAt(n),a=t.charAt(n);if(i!==a)return a>i?-1:1}return r>o?-1:0},n.intToDecimalForm=function(e){var t=0>e,n="";do{var o=t?-Math.ceil(e%10):Math.floor(e%10);n=o+n,e=t?Math.ceil(e/10):Math.floor(e/10)}while(e);return t&&"0"!==n&&(n="-"+n),n}},{}],57:[function(e,t){"use strict";function n(){this.promise=new o(function(e){e()})}var o=e("./utils").Promise;n.prototype.add=function(e){return this.promise=this.promise["catch"](function(){}).then(function(){return e()}),this.promise},n.prototype.finish=function(){return this.promise},t.exports=n},{"./utils":59}],58:[function(e,t){"use strict";function n(e,t,n){return new r(function(r,i){return t&&"object"==typeof t&&(t=t._id),"string"!=typeof t?i(new Error("doc id is required")):void e.get(t,function(a,l){if(a)return 404!==a.status?i(a):r(o(e,n({_id:t}),n));var s=n(l);return s?void r(o(e,s,n)):r(l)})})}function o(e,t,o){return e.put(t)["catch"](function(r){if(409!==r.status)throw r;return n(e,t,o)})}var r=e("./utils").Promise;t.exports=n},{"./utils":59}],59:[function(e,t,n){(function(t,o){"use strict";n.Promise="function"==typeof o.Promise?o.Promise:e("lie"),n.uniq=function(e){var t={};return e.forEach(function(e){t[e]=!0}),Object.keys(t)},n.inherits=e("inherits"),n.extend=e("pouchdb-extend");var r=e("argsarray");n.promisedCallback=function(e,n){return n&&e.then(function(e){t.nextTick(function(){n(null,e)})},function(e){t.nextTick(function(){n(e)})}),e},n.callbackify=function(e){return r(function(t){var o=t.pop(),r=e.apply(this,t);return"function"==typeof o&&n.promisedCallback(r,o),r})},n.fin=function(e,t){return e.then(function(e){var n=t();return"function"==typeof n.then?n.then(function(){return e}):e},function(e){var n=t();if("function"==typeof n.then)return n.then(function(){throw e});throw e})},n.sequentialize=function(e,t){return function(){var n=arguments,o=this;return e.add(function(){return t.apply(o,n)})}};var i=e("crypto"),a=e("spark-md5");n.MD5=function(e){return t.browser?a.hash(e):i.createHash("md5").update(e).digest("hex")}}).call(this,e("/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"/Users/daleharvey/src/pouchdb/node_modules/browserify/node_modules/insert-module-globals/node_modules/process/browser.js":31,argsarray:28,crypto:29,inherits:32,lie:36,"pouchdb-extend":51,"spark-md5":60}],60:[function(e,t,n){!function(e){if("object"==typeof n)t.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var o;try{o=window}catch(r){o=self}o.SparkMD5=e()}}(function(){"use strict";var e=function(e,t){return e+t&4294967295},t=function(t,n,o,r,i,a){return n=e(e(n,t),e(r,a)),e(n<<i|n>>>32-i,o)},n=function(e,n,o,r,i,a,l){return t(n&o|~n&r,e,n,i,a,l)},o=function(e,n,o,r,i,a,l){return t(n&r|o&~r,e,n,i,a,l)},r=function(e,n,o,r,i,a,l){return t(n^o^r,e,n,i,a,l)},i=function(e,n,o,r,i,a,l){return t(o^(n|~r),e,n,i,a,l)},a=function(t,a){var l=t[0],s=t[1],c=t[2],d=t[3];l=n(l,s,c,d,a[0],7,-680876936),d=n(d,l,s,c,a[1],12,-389564586),c=n(c,d,l,s,a[2],17,606105819),s=n(s,c,d,l,a[3],22,-1044525330),l=n(l,s,c,d,a[4],7,-176418897),d=n(d,l,s,c,a[5],12,1200080426),c=n(c,d,l,s,a[6],17,-1473231341),s=n(s,c,d,l,a[7],22,-45705983),l=n(l,s,c,d,a[8],7,1770035416),d=n(d,l,s,c,a[9],12,-1958414417),c=n(c,d,l,s,a[10],17,-42063),s=n(s,c,d,l,a[11],22,-1990404162),l=n(l,s,c,d,a[12],7,1804603682),d=n(d,l,s,c,a[13],12,-40341101),c=n(c,d,l,s,a[14],17,-1502002290),s=n(s,c,d,l,a[15],22,1236535329),l=o(l,s,c,d,a[1],5,-165796510),d=o(d,l,s,c,a[6],9,-1069501632),c=o(c,d,l,s,a[11],14,643717713),s=o(s,c,d,l,a[0],20,-373897302),l=o(l,s,c,d,a[5],5,-701558691),d=o(d,l,s,c,a[10],9,38016083),c=o(c,d,l,s,a[15],14,-660478335),s=o(s,c,d,l,a[4],20,-405537848),l=o(l,s,c,d,a[9],5,568446438),d=o(d,l,s,c,a[14],9,-1019803690),c=o(c,d,l,s,a[3],14,-187363961),s=o(s,c,d,l,a[8],20,1163531501),l=o(l,s,c,d,a[13],5,-1444681467),d=o(d,l,s,c,a[2],9,-51403784),c=o(c,d,l,s,a[7],14,1735328473),s=o(s,c,d,l,a[12],20,-1926607734),l=r(l,s,c,d,a[5],4,-378558),d=r(d,l,s,c,a[8],11,-2022574463),c=r(c,d,l,s,a[11],16,1839030562),s=r(s,c,d,l,a[14],23,-35309556),l=r(l,s,c,d,a[1],4,-1530992060),d=r(d,l,s,c,a[4],11,1272893353),c=r(c,d,l,s,a[7],16,-155497632),s=r(s,c,d,l,a[10],23,-1094730640),l=r(l,s,c,d,a[13],4,681279174),d=r(d,l,s,c,a[0],11,-358537222),c=r(c,d,l,s,a[3],16,-722521979),s=r(s,c,d,l,a[6],23,76029189),l=r(l,s,c,d,a[9],4,-640364487),d=r(d,l,s,c,a[12],11,-421815835),c=r(c,d,l,s,a[15],16,530742520),s=r(s,c,d,l,a[2],23,-995338651),l=i(l,s,c,d,a[0],6,-198630844),d=i(d,l,s,c,a[7],10,1126891415),c=i(c,d,l,s,a[14],15,-1416354905),s=i(s,c,d,l,a[5],21,-57434055),l=i(l,s,c,d,a[12],6,1700485571),d=i(d,l,s,c,a[3],10,-1894986606),c=i(c,d,l,s,a[10],15,-1051523),s=i(s,c,d,l,a[1],21,-2054922799),l=i(l,s,c,d,a[8],6,1873313359),d=i(d,l,s,c,a[15],10,-30611744),c=i(c,d,l,s,a[6],15,-1560198380),s=i(s,c,d,l,a[13],21,1309151649),l=i(l,s,c,d,a[4],6,-145523070),d=i(d,l,s,c,a[11],10,-1120210379),c=i(c,d,l,s,a[2],15,718787259),s=i(s,c,d,l,a[9],21,-343485551),t[0]=e(l,t[0]),t[1]=e(s,t[1]),t[2]=e(c,t[2]),t[3]=e(d,t[3])},l=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n},s=function(e){var t,n=[];for(t=0;64>t;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n},c=function(e){var t,n,o,r,i,s,c=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)a(d,l(e.substring(t-64,t)));for(e=e.substring(t-64),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(a(d,o),t=0;16>t;t+=1)o[t]=0;return r=8*c,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),s=parseInt(r[1],16)||0,o[14]=i,o[15]=s,a(d,o),d},d=function(e){var t,n,o,r,i,l,c=e.length,d=[1732584193,-271733879,-1732584194,271733878];for(t=64;c>=t;t+=64)a(d,s(e.subarray(t-64,t)));for(e=c>t-64?e.subarray(t-64):new Uint8Array(0),n=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t=0;n>t;t+=1)o[t>>2]|=e[t]<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(a(d,o),t=0;16>t;t+=1)o[t]=0;return r=8*c,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),l=parseInt(r[1],16)||0,o[14]=i,o[15]=l,a(d,o),d},u=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],p=function(e){var t,n="";for(t=0;4>t;t+=1)n+=u[e>>8*t+4&15]+u[e>>8*t&15];return n},f=function(e){var t;for(t=0;t<e.length;t+=1)e[t]=p(e[t]);return e.join("")},b=function(e){return f(c(e))},h=function(){this.reset()};return"5d41402abc4b2a76b9719d911017c592"!==b("hello")&&(e=function(e,t){var n=(65535&e)+(65535&t),o=(e>>16)+(t>>16)+(n>>16);return o<<16|65535&n}),h.prototype.append=function(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),this.appendBinary(e),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var t,n=this._buff.length;for(t=64;n>=t;t+=64)a(this._state,l(this._buff.substring(t-64,t)));return this._buff=this._buff.substr(t-64),this},h.prototype.end=function(e){var t,n,o=this._buff,r=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;r>t;t+=1)i[t>>2]|=o.charCodeAt(t)<<(t%4<<3);return this._finish(i,r),n=e?this._state:f(this._state),this.reset(),n},h.prototype._finish=function(e,t){var n,o,r,i=t;if(e[i>>2]|=128<<(i%4<<3),i>55)for(a(this._state,e),i=0;16>i;i+=1)e[i]=0;n=8*this._length,n=n.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(n[2],16),r=parseInt(n[1],16)||0,e[14]=o,e[15]=r,a(this._state,e)},h.prototype.reset=function(){return this._buff="",this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.destroy=function(){delete this._state,delete this._buff,delete this._length},h.hash=function(e,t){/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e)));var n=c(e);return t?n:f(n)},h.hashBinary=function(e,t){var n=c(e);return t?n:f(n)},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var t,n=this._concatArrayBuffer(this._buff,e),o=n.length;for(this._length+=e.byteLength,t=64;o>=t;t+=64)a(this._state,s(n.subarray(t-64,t)));return this._buff=o>t-64?n.subarray(t-64):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,n,o=this._buff,r=o.length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;r>t;t+=1)i[t>>2]|=o[t]<<(t%4<<3);return this._finish(i,r),n=e?this._state:f(this._state),this.reset(),n},h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._state=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var n=e.length,o=new Uint8Array(n+t.byteLength);return o.set(e),o.set(new Uint8Array(t),n),o},h.ArrayBuffer.hash=function(e,t){var n=d(new Uint8Array(e));return t?n:f(n)},h})},{}],61:[function(e,t,n){"use strict";function o(e,t,n){var o=n[n.length-1];e===o.element&&(n.pop(),o=n[n.length-1]);var r=o.element,i=o.index;if(Array.isArray(r))r.push(e);else if(i===t.length-2){var a=t.pop();r[a]=e}else t.push(e)}n.stringify=function(e){var t=[];t.push({obj:e});for(var n,o,r,i,a,l,s,c,d,u,p,f="";n=t.pop();)if(o=n.obj,r=n.prefix||"",i=n.val||"",f+=r,i)f+=i;else if("object"!=typeof o)f+="undefined"==typeof o?null:JSON.stringify(o);else if(null===o)f+="null";else if(Array.isArray(o)){for(t.push({val:"]"}),a=o.length-1;a>=0;a--)l=0===a?"":",",t.push({obj:o[a],prefix:l});t.push({val:"["})}else{s=[];for(c in o)o.hasOwnProperty(c)&&s.push(c);for(t.push({val:"}"}),a=s.length-1;a>=0;a--)d=s[a],u=o[d],p=a>0?",":"",p+=JSON.stringify(d)+":",t.push({obj:u,prefix:p});t.push({val:"{"})}return f},n.parse=function(e){for(var t,n,r,i,a,l,s,c,d,u=[],p=[],f=0;;)if(t=e[f++],"}"!==t&&"]"!==t&&"undefined"!=typeof t)switch(t){case" ":case"	":case"\n":case":":case",":break;case"n":f+=3,o(null,u,p);break;case"t":f+=3,o(!0,u,p);break;case"f":f+=4,o(!1,u,p);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",f--;;){if(r=e[f++],!/[\d\.\-e\+]/.test(r)){f--;break}n+=r}o(parseFloat(n),u,p);break;case'"':for(i="",a=void 0,l=0;s=e[f++],'"'!==s||"\\"===a&&l%2===1;)i+=s,a=s,"\\"===a?l++:l=0;o(JSON.parse('"'+i+'"'),u,p);break;case"[":c={element:[],index:u.length},u.push(c.element),p.push(c);break;case"{":d={element:{},index:u.length},u.push(d.element),p.push(d);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===u.length)return u.pop();o(u.pop(),u,p)}}},{}]},{},[20])(20)})}]);