webpackJsonp([5],{1:function(e,t,n){var r;r="http://teux.iriscouch.com/",n(6),angular.module("App",["angular.bundle","app.components"]).controller("AppController",["$scope","$compile","pouchdb",function(e,t,n){var o="testdb1",i=r+o,a=e.docs=n.create(o),s=function(){a.info().then(function(t){e.itemCount=t.doc_count})},l=function(){a.replicate.to(i),s()},c=function(){a.replicate.from(i,{live:!0,filter:"coauthor/latest"}).on("change",function(){s()})};e.addDoc=function(){a.post({timestamp:Date.now()}).then(l)},e.modifyDoc=function(e){a.put(e).then(l)},e.removeDoc=function(e){a.remove(e).then(l)},e.removeDocs=function(){a.allDocs({include_docs:!0}).then(function(e){return a.bulkDocs(e.rows.map(function(e){return{_id:e.doc._id,_rev:e.doc._rev,_deleted:!0}}))}).then(l)},e.getPhotoUrl=function(e){return a.getAttachment(e._id,"photo").then(function(e){return blobUtil.createObjectURL(e)})},a.replicate.from(i,{filter:"coauthor/latest"}).on("complete",function(){s(),c(),a.replicate.to(i)}),s()}])},6:function(e,t,n){angular.module("app.components",[]),n(20),n(21),n(22)},20:function(e,t,n){n(28)},21:function(e,t,n){n(26),n(27)},22:function(e,t,n){n(29),n(30)},26:function(){angular.module("app.components").controller("ShowPhotoController",["$scope","$element","$attrs",function(e){var t=function(){e.linkedNode&&(e.linkedNode.remove(),e.linkedNode=null)};e.$watch("doc._attachments.photo",function(n){t(),n&&e.linkFn(e,function(t){e.linkedNode=t,t.insertAfter(e.element),e.url().then(function(e){t.find("img").attr("src",e)})})})}])},27:function(e,t,n){angular.module("app.components").directive("showPhoto",["$compile",function(e){return{restrict:"EA",controller:"ShowPhotoController",transclude:"element",scope:{doc:"=",url:"&"},compile:function(){var t=e(n(102));return function(e,n){e.linkFn=t,e.element=n}}}}])},28:function(e,t,n){angular.module("app.components").factory("camera",["$rootScope","$compile",function(e,t){var r=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia),o=e.$new(),i=t(n(103))(o),a={supported:function(){return r},take:function(e,t){o.cameraEnabled=!0,o.elem=e,o.pipePhoto=t,i.insertAfter(e),i.show(),i.find("#ng-camera-feed").get(0).play()},close:function(){o.elem=null,o.pipePhoto=null,i.hide(),i.appendTo("body")},isOpen:function(e){return o.elem===e}};return o.$watch("media",function(){"function"==typeof o.pipePhoto&&o.pipePhoto(o.media)}),Object.keys(a).forEach(function(e){a[e]=function(e){return function(){return r?e.apply(this,arguments):!1}}(a[e])}),a}])},29:function(e,t,n){angular.module("app.components").directive("takePhoto",["$compile",function(e){return{restrict:"EA",controller:"TakePhotoController",transclude:"element",scope:{doc:"=",modify:"&"},compile:function(){var t=e(n(104));return function(e,n){t(e,function(t){e.linkedNode=t}),e.linkedNode.insertAfter(n)}}}}])},30:function(){angular.module("app.components").controller("TakePhotoController",["$scope","$element","$attrs","camera",function(e,t,n,r){e.$watch("doc._attachments.photo",function(t){e.hasPhoto=!!t}),e.takePhoto=function(){e.hasPhoto?(delete e.doc._attachments,e.modify(e.doc)):r.isOpen(e.linkedNode)?r.close():r.take(e.linkedNode,function(t){var n=t.match(/^data:([^;]+);base64,(.+)$/);e.doc._attachments={photo:{type:n[1],data:n[2]}},e.modify(),r.close()})}}])},102:function(e){var t='<div><img class="doc--photo"></div>';angular.module(["ng"]).run(["$templateCache",function(e){e.put("components/show-photo/show-photo.html",t)}]),e.exports=t},103:function(e){var t='<ng-camera type="photo" enabled="cameraEnabled" width="128" height="96" countdown="0" ng-model="media" capture-message="Go!"></ng-camera>';angular.module(["ng"]).run(["$templateCache",function(e){e.put("components/camera/camera.html",t)}]),e.exports=t},104:function(e){var t='<a href="#" ng-click="takePhoto()">{{hasPhoto ? "убрать фотку" : "сделать фотку"}}</a>';angular.module(["ng"]).run(["$templateCache",function(e){e.put("components/take-photo/take-photo.html",t)}]),e.exports=t}});